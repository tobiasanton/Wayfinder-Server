<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mc2: ClockWise.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">Shared</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">include</a></div>
<h1>ClockWise.h</h1><a href="ClockWise_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">Copyright (c) 1999 - 2010, Vodafone Group Services Ltd</span>
00003 <span class="comment">All rights reserved.</span>
00004 <span class="comment"></span>
00005 <span class="comment">Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
00008 <span class="comment">    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
00009 <span class="comment">    * Neither the name of the Vodafone Group Services Ltd nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
00010 <span class="comment"></span>
00011 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00012 <span class="comment">*/</span>
00013 
00014 <span class="preprocessor">#ifndef CLOCKWISE_H</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define CLOCKWISE_H</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#include "<a class="code" href="config_8h.html">config.h</a>"</span>
00018 <span class="preprocessor">#include &lt;utility&gt;</span>
00019 <span class="preprocessor">#include "<a class="code" href="MC2Coordinate_8h.html">MC2Coordinate.h</a>"</span>
00020 
<a name="l00021"></a><a class="code" href="namespaceGfxUtil.html">00021</a> <span class="keyword">namespace </span>GfxUtil {
00022 
00023 <span class="comment">// Eh. Private.</span>
00024 <span class="keyword">namespace </span>{
<a name="l00025"></a><a class="code" href="classGfxUtil_1_1ThreeCoords.html">00025</a> <span class="keyword">template</span>&lt;<span class="keyword">class</span> ITERATOR&gt; <span class="keyword">class </span><a class="code" href="classGfxUtil_1_1ThreeCoords.html">ThreeCoords</a> {
00026 <span class="keyword">public</span>:
00027    
<a name="l00028"></a><a class="code" href="classGfxUtil_1_1ThreeCoords.html#a0">00028</a>    <a class="code" href="classGfxUtil_1_1ThreeCoords.html">ThreeCoords</a>( <span class="keyword">const</span> ITERATOR&amp; prev,
00029                 <span class="keyword">const</span> ITERATOR&amp; middle,
00030                 <span class="keyword">const</span> ITERATOR&amp; next )
00031          : m_prev( prev ),
00032            m_middle( middle ),
00033            m_next( next ) {}
00034 
<a name="l00035"></a><a class="code" href="classGfxUtil_1_1ThreeCoords.html#o0">00035</a>    ITERATOR m_prev;
<a name="l00036"></a><a class="code" href="classGfxUtil_1_1ThreeCoords.html#o1">00036</a>    ITERATOR m_middle;
<a name="l00037"></a><a class="code" href="classGfxUtil_1_1ThreeCoords.html#o2">00037</a>    ITERATOR m_next;
00038    
00039 };
00040 
00041 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ITERATOR&gt;
00042 <span class="keyword">class </span><a class="code" href="classGfxUtil_1_1ThreeCoords.html">ThreeCoords</a>&lt;ITERATOR&gt;
<a name="l00043"></a><a class="code" href="namespaceGfxUtil.html#a0">00043</a> <a class="code" href="namespaceGfxUtil.html#a0">getNorthestCorner3</a>( const ITERATOR&amp; begin,
00044                    <span class="keyword">const</span> ITERATOR&amp; end )
00045 {
00046    <span class="keyword">const</span> <a class="code" href="classGfxUtil_1_1ThreeCoords.html">ThreeCoords&lt;ITERATOR&gt;</a> invalid(end, end, end);
00047    <span class="keywordflow">if</span> ( begin == end ) {
00048       <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[getNorthestCorner]: Empty range"</span> &lt;&lt; endl;
00049       <span class="comment">// Empty range</span>
00050       <span class="keywordflow">return</span> invalid;
00051    }
00052 
00053    <span class="comment">// Do stuff</span>
00054    ITERATOR it = begin;
00055    ++it;
00056    <span class="keywordflow">if</span> ( it == end ) {
00057       <span class="comment">// One coordinate in range</span>
00058       <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[getNorthestCorner]: One coordinate in range"</span> &lt;&lt; endl;
00059       <span class="keywordflow">return</span> invalid;
00060    }
00061 
00062    {
00063       ITERATOR next = it;
00064       ++next;
00065       <span class="keywordflow">if</span> ( next == end ) {
00066          <span class="comment">// Only two coordinates in range</span>
00067          <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[getNorthestCorner]: Only two coordinates range"</span> &lt;&lt; endl;
00068          <span class="keywordflow">return</span> invalid;
00069       }
00070    }
00071 
00072    ITERATOR maxYItPrev = begin; <span class="comment">// Will be invalid if the first one is the one</span>
00073    ITERATOR maxYIt     = begin; <span class="comment">// One before "it"</span>
00074 
00075    ITERATOR prev = begin; <span class="comment">// The iterator before "it".</span>
00076    ITERATOR last = begin; <span class="comment">// The last iterator, since we canno step backwards</span>
00077    
00078    <span class="comment">// Go through the coordinates and select the one that is most</span>
00079    <span class="comment">// to the north. If there are more than one, compare lon too.</span>
00080    <span class="comment">// Keep prev lagging behind "it" and save the last iterator to be</span>
00081    <span class="comment">// able to set prev to that if it hasn't moved.</span>
00082    <span class="comment">//</span>
00083    <span class="comment">// Try to find the coordinate most to the east of the northest ones.</span>
00084    <span class="keywordflow">for</span> ( ; it != end; prev = it, ++it ) {
00085       <span class="keywordflow">if</span> ( <a class="code" href="namespaceGfxUtil.html#a16">getCoordY</a>( *maxYIt ) &lt; <a class="code" href="namespaceGfxUtil.html#a16">getCoordY</a>( *it ) ||
00086           ( ( <a class="code" href="namespaceGfxUtil.html#a16">getCoordY</a>( *maxYIt ) == <a class="code" href="namespaceGfxUtil.html#a16">getCoordY</a>( *it ) ) &amp;&amp;
00087             ( <a class="code" href="namespaceGfxUtil.html#a15">getCoordX</a>( *it ) &gt;= <a class="code" href="namespaceGfxUtil.html#a15">getCoordX</a>( *maxYIt ) ) ) ) {
00088          maxYItPrev  = prev;
00089          maxYIt      = it;
00090       }
00091       last = it;
00092    }
00093    <span class="keywordflow">if</span> ( maxYIt == begin ) {
00094       <span class="comment">// Has not moved. Take the last one before end.</span>
00095       <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[getNorthestCorner]: has not moved"</span> &lt;&lt; endl;
00096       maxYItPrev = last;
00097       
00098       <span class="comment">// We cannot go backwards, so the prev better not be</span>
00099       <span class="comment">// same as middle. The loop above should take care of that</span>
00100       <span class="comment">// if the polygon is manually closed, but not if it contains</span>
00101       <span class="comment">// duplicate end points.</span>
00102       <a class="code" href="config_8h.html#a29">MC2_ASSERT</a>( *maxYIt != *maxYItPrev );
00103    }
00104    ITERATOR maxYItNext = maxYIt;
00105    ++maxYItNext;
00106    <span class="keywordflow">if</span> ( maxYItNext == end ) {
00107       <span class="comment">// Past end</span>
00108       <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[getNorthestCorner]: past end"</span> &lt;&lt; endl;
00109       maxYItNext = begin;
00110       <span class="comment">// Handle that the polygon is manually closed, </span>
00111       <span class="comment">// i.e. first and last coordinate is same.</span>
00112       <span class="keywordflow">if</span> ( *maxYIt == *maxYItNext ) {
00113          ++maxYItNext;
00114       }
00115    }
00116    <span class="keywordflow">return</span> <a class="code" href="classGfxUtil_1_1ThreeCoords.html">ThreeCoords&lt;ITERATOR&gt;</a>( maxYItPrev, maxYIt, maxYItNext );
00117 }
00118 }
00119 
00120 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ITERATOR&gt;
00121 ITERATOR
<a name="l00122"></a><a class="code" href="namespaceGfxUtil.html#a1">00122</a> <a class="code" href="namespaceGfxUtil.html#a1">getNorthestCorner</a>( <span class="keyword">const</span> ITERATOR&amp; begin,
00123                    <span class="keyword">const</span> ITERATOR&amp; end )
00124 {
00125    <span class="keywordflow">return</span> <a class="code" href="namespaceGfxUtil.html#a0">getNorthestCorner3</a>(begin, end).<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o1">m_middle</a>;
00126 }
00127 
00138 <span class="keyword">template</span>&lt;<span class="keyword">class</span> ITERATOR&gt;
<a name="l00139"></a><a class="code" href="namespaceGfxUtil.html#a2">00139</a> <span class="keywordtype">int</span> <a class="code" href="namespaceGfxUtil.html#a2">isClockWise</a>( <span class="keyword">const</span> ITERATOR&amp; begin,
00140                  <span class="keyword">const</span> ITERATOR&amp; end )
00141 {
00142    <a class="code" href="classGfxUtil_1_1ThreeCoords.html">ThreeCoords&lt;ITERATOR&gt;</a> coords = <a class="code" href="namespaceGfxUtil.html#a0">getNorthestCorner3</a>( begin, end );
00143    
00144    <span class="keywordflow">if</span> ( coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o0">m_prev</a> == end || coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o1">m_middle</a> == end || coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o2">m_next</a> == end ) {
00145       <span class="comment">// To few coordinates</span>
00146       <span class="keywordflow">return</span> -1;
00147    }
00148 
00149 <span class="preprocessor">#if 0 </span>
00150 <span class="preprocessor"></span>   <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[isClockWise]: "</span>
00151            &lt;&lt; coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o0">m_prev</a> &lt;&lt; <span class="stringliteral">", "</span> &lt;&lt; coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o1">m_middle</a>  &lt;&lt; <span class="stringliteral">", "</span>
00152            &lt;&lt; coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o2">m_next</a> &lt;&lt; endl;
00153 <span class="preprocessor">#endif</span>
00154 <span class="preprocessor"></span>  
00155    <span class="comment">// Could this be isLeft?</span>
00156    <a class="code" href="Types_8h.html#a22">int32</a> x1 = <a class="code" href="namespaceGfxUtil.html#a15">getCoordX</a>( *coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o0">m_prev</a> ) - <a class="code" href="namespaceGfxUtil.html#a15">getCoordX</a>( *coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o1">m_middle</a> );
00157    <a class="code" href="Types_8h.html#a22">int32</a> y1 = <a class="code" href="namespaceGfxUtil.html#a16">getCoordY</a>( *coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o0">m_prev</a> ) - <a class="code" href="namespaceGfxUtil.html#a16">getCoordY</a>( *coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o1">m_middle</a> );
00158    <a class="code" href="Types_8h.html#a22">int32</a> x2 = <a class="code" href="namespaceGfxUtil.html#a15">getCoordX</a>( *coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o2">m_next</a> ) - <a class="code" href="namespaceGfxUtil.html#a15">getCoordX</a>( *coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o1">m_middle</a> );
00159    <a class="code" href="Types_8h.html#a22">int32</a> y2 = <a class="code" href="namespaceGfxUtil.html#a16">getCoordY</a>( *coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o2">m_next</a> ) - <a class="code" href="namespaceGfxUtil.html#a16">getCoordY</a>( *coords.<a class="code" href="classGfxUtil_1_1ThreeCoords.html#o1">m_middle</a> );
00160 
00161    <a class="code" href="Types_8h.html#a24">int64</a> crossprod = ((int64)x1)*y2 - ((int64)y1)*x2;
00162    
00163    <span class="keywordflow">if</span> (crossprod &gt; 0) {
00164       <span class="keywordflow">return</span> 1; <span class="comment">// Clockwise</span>
00165    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (crossprod &lt; 0) {
00166       <span class="keywordflow">return</span> 0; <span class="comment">// Counterclockwise</span>
00167    } <span class="keywordflow">else</span> {
00168       <span class="keywordflow">return</span> -1; <span class="comment">// This polygon is corrupt</span>
00169    }
00170 }
00171 
00172 }
00173 
00174 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jun 30 10:11:45 2010 for mc2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
