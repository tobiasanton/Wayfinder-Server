<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mc2: ClipUtil.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">Shared</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">include</a></div>
<h1>ClipUtil.h</h1><a href="ClipUtil_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">Copyright (c) 1999 - 2010, Vodafone Group Services Ltd</span>
00003 <span class="comment">All rights reserved.</span>
00004 <span class="comment"></span>
00005 <span class="comment">Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
00008 <span class="comment">    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
00009 <span class="comment">    * Neither the name of the Vodafone Group Services Ltd nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
00010 <span class="comment"></span>
00011 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00012 <span class="comment">*/</span>
00013 
00014 <span class="preprocessor">#ifndef CLIP_UTIL_H</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define CLIP_UTIL_H</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#include "<a class="code" href="config_8h.html">config.h</a>"</span>
00018 
00019 <span class="preprocessor">#include &lt;vector&gt;</span>
00020 <span class="preprocessor">#include "<a class="code" href="MC2BoundingBox_8h.html">MC2BoundingBox.h</a>"</span>
00021 <span class="preprocessor">#include "<a class="code" href="MC2Point_8h.html">MC2Point.h</a>"</span>
00022 <span class="preprocessor">#include "<a class="code" href="MC2Coordinate_8h.html">MC2Coordinate.h</a>"</span>
00023 
<a name="l00024"></a><a class="code" href="classClipUtil.html">00024</a> <span class="keyword">class </span><a class="code" href="classClipUtil.html">ClipUtil</a> {
00025 <span class="keyword">public</span>:
00026 
00027    <span class="keyword">template</span>&lt;<span class="keyword">class</span> ITERATOR&gt;
<a name="l00028"></a><a class="code" href="classClipUtil.html#e0">00028</a>       <span class="keyword">static</span> <span class="keywordtype">int</span> clipPolyToBBoxFast( <span class="keyword">const</span> <a class="code" href="classMC2BoundingBox.html">MC2BoundingBox</a>&amp; bbox,
00029                                      <a class="code" href="classvector.html">vector&lt;MC2Coordinate&gt;</a>&amp; result,
00030                                      ITERATOR begin,
00031                                      ITERATOR end ) {
00032       <a class="code" href="classvector.html">vector&lt;MC2Point&gt;</a> pointVec;
00033       pointVec.clear();
00034       {
00035          <span class="keywordflow">for</span> ( ITERATOR it = begin;
00036                it != end;
00037                ++it ) {
00038             pointVec.push_back( <a class="code" href="classMC2Point.html">MC2Point</a>( it-&gt;lon, it-&gt;lat) );
00039          }
00040       }
00041       <span class="keywordtype">int</span> resultBool = clipPolyToBBoxFast( bbox, pointVec );
00042       <span class="keywordflow">if</span> ( resultBool ) {
00043          result.clear();
00044          result.reserve( pointVec.size() );
00045          <span class="keywordflow">for</span>( <a class="code" href="classvector.html">vector&lt;MC2Point&gt;</a>::iterator it = pointVec.begin();
00046               it != pointVec.end();
00047               ++it ) {
00048             result.push_back( <a class="code" href="classMC2Coordinate.html">MC2Coordinate</a>( it-&gt;getY(), it-&gt;getX() ) );
00049          }
00050       }
00051       <span class="keywordflow">return</span> resultBool;
00052    }
00053                             
00054    
00076    <span class="keyword">template</span>&lt;<span class="keyword">class</span> XYHELPER, <span class="keyword">class</span> ITERATABLE, <span class="keyword">class</span> POINT_SEQUENCE &gt;
<a name="l00077"></a><a class="code" href="classClipUtil.html#e1">00077</a>       <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> reduceByBBox( <span class="keyword">const</span> XYHELPER&amp; xyhelper,
00078                                        <span class="keyword">const</span> <a class="code" href="classMC2BoundingBox.html">MC2BoundingBox</a>&amp; bbox,
00079                                        <span class="keyword">const</span> ITERATABLE&amp; vertices,
00080                                        POINT_SEQUENCE&amp; reducedVertices,
00081                                        <a class="code" href="classvector.html">vector&lt;uint8&gt;</a>* outcodes ) {
00082       <span class="keywordflow">if</span> ( vertices.size() &lt; 3 ) {
00083          <span class="keywordflow">return</span> <span class="keyword">false</span>;
00084       }
00085       
00086       <span class="comment">// Initialize the vertice and outcode vector.</span>
00087       <a class="code" href="Types_8h.html#a21">uint32</a> prevOutcode;
00088       <a class="code" href="Types_8h.html#a21">uint32</a> firstOutcode;
00089       
00090       <span class="keyword">typename</span> ITERATABLE::value_type currVertex;
00091       <span class="keyword">typename</span> POINT_SEQUENCE::value_type nextVertex;
00092       <span class="comment">// Add all of the polygon</span>
00093       <span class="keyword">typename</span> POINT_SEQUENCE::const_iterator it = vertices.begin();
00094       currVertex = *it;
00095       prevOutcode = firstOutcode =
00096          bbox.<a class="code" href="classMC2BoundingBox.html#a40">getCohenSutherlandOutcode</a>(xyhelper.getY(currVertex),
00097                                         xyhelper.getX(currVertex) );
00098       <span class="comment">// Add the first one.</span>
00099       reducedVertices.push_back( currVertex );
00100       <span class="keywordflow">if</span> ( outcodes ) {
00101          outcodes-&gt;push_back( prevOutcode );
00102       }
00103       
00104       ++it;
00105       currVertex = *it;
00106       <a class="code" href="Types_8h.html#a21">uint32</a> currOutcode = 
00107          bbox.<a class="code" href="classMC2BoundingBox.html#a40">getCohenSutherlandOutcode</a>(xyhelper.getY(currVertex),
00108                                         xyhelper.getX(currVertex) );
00109       
00110       
00111       ++it;
00112       <span class="keywordflow">for</span> ( ; it != vertices.end(); ++it ) {
00113          nextVertex = *it;
00114          <a class="code" href="Types_8h.html#a25">byte</a> nextOutcode =
00115             bbox.<a class="code" href="classMC2BoundingBox.html#a40">getCohenSutherlandOutcode</a>(xyhelper.getY(nextVertex),
00116                                            xyhelper.getX(nextVertex));
00117          
00118          <span class="keywordflow">if</span> ((prevOutcode &amp; currOutcode &amp; nextOutcode) == 0) {
00119             reducedVertices.push_back( currVertex );
00120             <span class="keywordflow">if</span> ( outcodes ) {
00121                outcodes-&gt;push_back( currOutcode );
00122             }
00123             prevOutcode = currOutcode;
00124          }
00125          currOutcode = nextOutcode;
00126          currVertex = nextVertex;
00127       }
00128       
00129       <span class="comment">// Check the last one.</span>
00130       <span class="keywordflow">if</span> ((prevOutcode &amp; currOutcode &amp; firstOutcode) == 0) {
00131          reducedVertices.push_back( currVertex );
00132          <span class="keywordflow">if</span> ( outcodes ) {
00133             outcodes-&gt;push_back( currOutcode );
00134          }
00135       }
00136       
00137       <span class="keywordflow">if</span> ( xyhelper.getX(reducedVertices.back()) !=
00138            xyhelper.getX(reducedVertices.front()) ||
00139            xyhelper.getY(reducedVertices.back()) !=
00140            xyhelper.getY(reducedVertices.front()) ) {
00141          <span class="comment">// Add first coordinate last again.</span>
00142          reducedVertices.push_back( reducedVertices.front() );
00143       }
00144       
00145       
00146       <span class="comment">// If we end up with less than three coordinates then it's not a</span>
00147       <span class="comment">// valid closed polygon anymore.</span>
00148       <span class="keywordtype">bool</span> retVal;
00149       <span class="keywordflow">if</span> (reducedVertices.size() &lt; 3) {
00150          <span class="keywordflow">if</span> ( outcodes ) {
00151             outcodes-&gt;clear();
00152          }
00153          retVal = <span class="keyword">false</span>;
00154       } <span class="keywordflow">else</span> {
00155          retVal = <span class="keyword">true</span>;
00156       }
00157       
00158       <span class="keywordflow">return</span> (retVal);
00159    }
00160    
00161 <span class="keyword">private</span>:
00162 
00163    <span class="keyword">static</span> <span class="keywordtype">void</span> clipSegment( <span class="keyword">const</span> <a class="code" href="classMC2Point.html">MC2Point</a>&amp; prevVertex,
00164                             <span class="keyword">const</span> <a class="code" href="classMC2Point.html">MC2Point</a>&amp; currVertex,
00165                             <span class="keywordtype">int</span> prevInside,
00166                             <span class="keywordtype">int</span> currInside,
00167                             byte currOutcode,
00168                             <span class="keyword">const</span> <a class="code" href="classMC2BoundingBox.html">MC2BoundingBox</a>* bbox,
00169                             byte boundaryOutcode,
00170                             <a class="code" href="classvector.html">vector&lt;byte&gt;</a>&amp; resOutcodes,
00171                             <a class="code" href="classvector.html">vector&lt;MC2Point&gt;</a>&amp; resVertices );
00172    
00173    
00174    <span class="keyword">static</span> <span class="keywordtype">int</span> clipToBoundary( <span class="keyword">const</span> byte boundaryOutcode,
00175                               <span class="keyword">const</span> <a class="code" href="classMC2BoundingBox.html">MC2BoundingBox</a>* bbox,
00176                               <a class="code" href="classvector.html">vector&lt;MC2Point&gt;</a>&amp; vertices,
00177                               <a class="code" href="classvector.html">vector&lt;byte&gt;</a>&amp; outcodes,
00178                               <a class="code" href="classvector.html">vector&lt;MC2Point&gt;</a>&amp; resVertices,
00179                               <a class="code" href="classvector.html">vector&lt;byte&gt;</a>&amp; resOutcodes  );
00180 
00181    
00182    <span class="keywordtype">int</span> <span class="keyword">static</span> clipPolyToBBoxFast( <span class="keyword">const</span> <a class="code" href="classMC2BoundingBox.html">MC2BoundingBox</a>&amp; bbox, 
00183                                   <a class="code" href="classvector.html">vector&lt;MC2Point&gt;</a>&amp; vertices );
00184 
00185 };
00186 
00187 
00188 <span class="preprocessor">#endif</span>
00189 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jun 30 10:11:45 2010 for mc2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
