<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mc2: ItemComboTable.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">Server</a>&nbsp;/&nbsp;<a class="el" href="dir_000005.html">Shared</a>&nbsp;/&nbsp;<a class="el" href="dir_000006.html">include</a></div>
<h1>ItemComboTable.h</h1><a href="ItemComboTable_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">Copyright (c) 1999 - 2010, Vodafone Group Services Ltd</span>
00003 <span class="comment">All rights reserved.</span>
00004 <span class="comment"></span>
00005 <span class="comment">Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
00008 <span class="comment">    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
00009 <span class="comment">    * Neither the name of the Vodafone Group Services Ltd nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
00010 <span class="comment"></span>
00011 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00012 <span class="comment">*/</span>
00013 
00014 <span class="preprocessor">#ifndef ITEM_COMBO_TABLE_H</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define ITEM_COMBO_TABLE_H</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#include "<a class="code" href="ItemDataTable_8h.html">ItemDataTable.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="DataTable_8h.html">DataTable.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="ItemComboTableFwd_8h.html">ItemComboTableFwd.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="AlignUtility_8h.html">AlignUtility.h</a>"</span>
00021 
00022 <span class="preprocessor">#include &lt;algorithm&gt;</span>
00023 
00035 <span class="keyword">template</span>&lt;<span class="keyword">class </span>VALUE_TYPE, <span class="keyword">class </span>INTEGER_TYPE, 
00036          <span class="keyword">class </span>VALUE_SAVER_T 
00037          <span class="comment">//The default value is actually set in ItemComboTableFwd.h</span>
00038           <span class="comment">/*= LoaderTypeSelector&lt;VALUE_TYPE&gt; */</span>&gt;
<a name="l00039"></a><a class="code" href="classItemComboTable.html">00039</a> <span class="keyword">class </span><a class="code" href="classItemComboTable.html">ItemComboTable</a>: <span class="keyword">public</span> <a class="code" href="classDataTable.html">DataTable</a>&lt;VALUE_TYPE&gt; {
00040 <span class="keyword">private</span>:
<a name="l00041"></a><a class="code" href="classItemComboTable.html#y0">00041</a>    <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classLoaderTypeSelector.html">LoaderTypeSelector&lt;VALUE_TYPE&gt;</a>::loaderType <a class="code" href="classItemComboLoader.html">VALUE_SAVER</a>;
00042    <span class="keyword">typedef</span> <a class="code" href="classItemDataTable.html">ItemDataTable</a>&lt;INTEGER_TYPE,
<a name="l00043"></a><a class="code" href="classItemComboTable.html#y1">00043</a>                          <a class="code" href="classItemComboLoader.html">ItemComboLoader&lt;INTEGER_TYPE&gt;</a> &gt; <a class="code" href="classItemDataTable.html">otherTable_t</a>;
00044    <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classItemDataTable.html">ItemDataTable</a>&lt;INTEGER_TYPE,
<a name="l00045"></a><a class="code" href="classItemComboTable.html#y2">00045</a>                          <a class="code" href="classItemComboLoader.html">ItemComboLoader&lt;INTEGER_TYPE&gt;</a> &gt;::itemMap_t <a class="code" href="classmap.html">otherMap_t</a>;
<a name="l00046"></a><a class="code" href="classItemComboTable.html#n0">00046</a>    <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classM3Creator.html">M3Creator</a>;
00047 <span class="keyword">public</span>:
<a name="l00049"></a><a class="code" href="classItemComboTable.html#w0">00049</a>    <span class="keyword">typedef</span> std::map&lt;uint32, VALUE_TYPE&gt; itemMap_t;
00050 
00052    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l00053"></a><a class="code" href="structItemComboTable_1_1LessSecond.html">00053</a>    <span class="keyword">struct </span><a class="code" href="structItemComboTable_1_1LessSecond.html">LessSecond</a>:<span class="keyword">public</span> std::less&lt; T &gt; {
<a name="l00054"></a><a class="code" href="structItemComboTable_1_1LessSecond.html#a0">00054</a>       <span class="keywordtype">bool</span> <a class="code" href="structItemComboTable_1_1LessSecond.html#a0">operator () </a>(<span class="keyword">const</span> T&amp; a, <span class="keyword">const</span> T&amp; b)<span class="keyword"> const </span>{
00055          <span class="keywordflow">return</span> a.second &lt; b.second;
00056       }
00057    };
00058 
<a name="l00059"></a><a class="code" href="classItemComboTable.html#a0">00059</a>    <a class="code" href="classItemComboTable.html#a0">ItemComboTable</a>() {
00060       <a class="code" href="classItemComboTable.html#d1">init</a>();
00061    }
00062 
<a name="l00070"></a><a class="code" href="classItemComboTable.html#a1">00070</a>    <a class="code" href="classItemComboTable.html#a0">ItemComboTable</a>( <span class="keyword">const</span> VALUE_TYPE&amp; defaultVal,
00071                    <span class="keyword">const</span> itemMap_t&amp; itemsToAdd ) {
00072       <a class="code" href="classItemComboTable.html#d1">init</a>();
00073       <a class="code" href="classItemComboTable.html#a11">setValues</a>( defaultVal, itemsToAdd );
00074    }
00075 
<a name="l00076"></a><a class="code" href="classItemComboTable.html#a2">00076</a>    <span class="keyword">explicit</span> <a class="code" href="classItemComboTable.html#a0">ItemComboTable</a>( <span class="keyword">const</span> itemMap_t&amp; itemsToAdd ) {
00077       <a class="code" href="classItemComboTable.html#d1">init</a>();
00078       <span class="keyword">typename</span> itemMap_t::value_type def = <a class="code" href="classItemComboTable.html#e1">getBestDefaultValue</a>( itemsToAdd );
00079 
00080       <a class="code" href="classItemComboTable.html#a11">setValues</a>( def.second, itemsToAdd ); 
00081    }
00082 
<a name="l00083"></a><a class="code" href="classItemComboTable.html#a3">00083</a>    <span class="keyword">virtual</span> <a class="code" href="classItemComboTable.html#a3">~ItemComboTable</a>() {
00084       <a class="code" href="classItemComboTable.html#a15">clear</a>();
00085    }
00086 
00092    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> TYPE_ONE, <span class="keyword">typename</span> TYPE_TWO&gt;
<a name="l00093"></a><a class="code" href="classItemComboTable.html#e0">00093</a>    <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classItemComboTable.html#e0">getCombinations</a>(<span class="keyword">const</span> std::map&lt;TYPE_ONE, TYPE_TWO&gt; &amp;items,
00094                                std::map&lt;TYPE_TWO, uint32&gt; &amp;combos ) {
00095 
00096       <span class="keyword">typename</span> std::map&lt;TYPE_ONE, TYPE_TWO&gt;::const_iterator it = items.begin();
00097       <span class="keyword">typename</span> std::map&lt;TYPE_ONE, TYPE_TWO&gt;::const_iterator it_end =
00098          items.end();
00099       <span class="keywordflow">for</span> ( ; it != it_end; ++it ) {
00100          <span class="keywordflow">if</span> ( combos.find( it-&gt;second ) == combos.end() ) {
00101             combos[ it-&gt;second ] = 1;
00102          } <span class="keywordflow">else</span> {
00103             combos[ it-&gt;second ] = combos[ it-&gt;second ] + 1;
00104          }
00105       }      
00106 
00107    }
00108 
00109    <span class="keyword">static</span> <span class="keyword">typename</span> itemMap_t::value_type
<a name="l00110"></a><a class="code" href="classItemComboTable.html#e1">00110</a>    <a class="code" href="classItemComboTable.html#e1">getBestDefaultValue</a>(<span class="keyword">const</span> itemMap_t &amp;items) {
00111       <span class="comment">//</span>
00112       <span class="comment">// Calculate default value</span>
00113       <span class="comment">// by counting number of different combinations</span>
00114       <span class="comment">// and selecting the combination that has the most </span>
00115       <span class="comment">// counts to be the default value</span>
00116       <span class="comment">//</span>
00117 
00118       <span class="keyword">typedef</span> std::map&lt;VALUE_TYPE, uint32&gt; reverseItemMap_t;
00119       reverseItemMap_t counterMap;
00120 
00121       <a class="code" href="classItemComboTable.html#e0">getCombinations</a>( items, counterMap );
00122 
00123       <span class="keyword">typename</span> reverseItemMap_t::iterator max_it = 
00124          std::max_element( counterMap.begin(),
00125                            counterMap.end(),
00126                          LessSecond&lt;typename reverseItemMap_t::value_type&gt;() );
00127 
00128       <span class="keywordflow">return</span> make_pair( max_it-&gt;second, max_it-&gt;first );
00129    }
00130 
00131 
<a name="l00133"></a><a class="code" href="classItemComboTable.html#a4">00133</a>    <span class="keyword">const</span> VALUE_TYPE&amp; <a class="code" href="classItemComboTable.html#a4">getDefault</a>()<span class="keyword"> const </span>{
00134       <span class="keywordflow">return</span> m_combos[ m_dataTable-&gt;<a class="code" href="classItemDataTable.html#a3">getDefault</a>() ];
00135    }
00136 
<a name="l00138"></a><a class="code" href="classItemComboTable.html#a5">00138</a>    <a class="code" href="classItemComboTable.html#a0">ItemComboTable</a>( <span class="keyword">const</span> <a class="code" href="classItemComboTable.html">ItemComboTable</a>&amp; other ) {
00139       <a class="code" href="classItemComboTable.html#d1">init</a>();
00140       itemMap_t itemsToAdd;
00141       other.<a class="code" href="classItemComboTable.html#a8">getAllData</a>( itemsToAdd );
00142       <a class="code" href="classItemComboTable.html#a11">setValues</a>( other.<a class="code" href="classItemComboTable.html#a4">getDefault</a>(), itemsToAdd );
00143    }
00144 
<a name="l00146"></a><a class="code" href="classItemComboTable.html#a6">00146</a>    <a class="code" href="classItemComboTable.html#a0">ItemComboTable</a>( <span class="keyword">const</span> <a class="code" href="classItemComboTable.html">ItemComboTable</a>&amp; other,
00147                    <span class="keyword">const</span> set&lt;uint32&gt;&amp; allowedItems ) {
00148       VALUE_TYPE defVal = other.<a class="code" href="classItemComboTable.html#a4">getDefault</a>();
00149       <a class="code" href="classItemComboTable.html#d1">init</a>();
00150       itemMap_t itemsToAdd;
00151       other.<a class="code" href="classItemComboTable.html#a8">getAllData</a>( itemsToAdd, allowedItems );
00152       <a class="code" href="classItemComboTable.html#a11">setValues</a>( defVal, itemsToAdd );
00153    }
00154    
<a name="l00156"></a><a class="code" href="classItemComboTable.html#a7">00156</a>    <a class="code" href="classItemComboTable.html">ItemComboTable</a>&amp; <a class="code" href="classItemComboTable.html#a7">operator=</a>( <span class="keyword">const</span> <a class="code" href="classItemComboTable.html">ItemComboTable</a>&amp; other ) {
00157       <span class="keywordflow">if</span> ( <span class="keyword">this</span> != &amp; other ) {
00158          VALUE_TYPE defVal = other.<a class="code" href="classItemComboTable.html#a4">getDefault</a>();
00159          <a class="code" href="classItemComboTable.html#a15">clear</a>();
00160          itemMap_t itemsToAdd;
00161          other.<a class="code" href="classItemComboTable.html#a8">getAllData</a>( itemsToAdd );
00162          <a class="code" href="classItemComboTable.html#a11">setValues</a>( defVal, itemsToAdd );
00163       }
00164       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00165    }
00166 
<a name="l00168"></a><a class="code" href="classItemComboTable.html#a8">00168</a>    <span class="keywordtype">int</span> <a class="code" href="classItemComboTable.html#a8">getAllData</a>( itemMap_t&amp; res )<span class="keyword"> const </span>{
00169       <a class="code" href="classmap.html">otherMap_t</a> tmpMap;
00170       m_dataTable-&gt;<a class="code" href="classItemDataTable.html#a6">getAllData</a>( tmpMap );
00171       <span class="keywordflow">for</span>( <span class="keyword">typename</span> otherMap_t::const_iterator it = tmpMap.begin();
00172            it != tmpMap.end();
00173            ++it ) {
00174          res.insert( make_pair( it-&gt;first, m_combos[ it-&gt;second ] ) );
00175       }
00176       <span class="keywordflow">return</span> res.size();
00177    }
00178    
<a name="l00180"></a><a class="code" href="classItemComboTable.html#a9">00180</a>    <span class="keywordtype">int</span> <a class="code" href="classItemComboTable.html#a8">getAllData</a>( itemMap_t&amp; res, <span class="keyword">const</span> set&lt;uint32&gt;&amp; allowedItems )<span class="keyword"> const </span>{
00181       <a class="code" href="classmap.html">otherMap_t</a> tmpMap;
00182       m_dataTable-&gt;<a class="code" href="classItemDataTable.html#a6">getAllData</a>( tmpMap, allowedItems );
00183       <span class="keywordflow">for</span>( <span class="keyword">typename</span> otherMap_t::const_iterator it = tmpMap.begin();
00184            it != tmpMap.end();
00185            ++it ) {
00186          res.insert( make_pair( it-&gt;first, m_combos[ it-&gt;second ] ) );
00187       }
00188       <span class="keywordflow">return</span> res.size();
00189    }
00190    
00191    
<a name="l00193"></a><a class="code" href="classItemComboTable.html#a10">00193</a>    <span class="keyword">const</span> VALUE_TYPE&amp; <a class="code" href="classItemComboTable.html#a10">getData</a>( uint32 itemID )<span class="keyword"> const </span>{
00194       <span class="keywordflow">return</span> m_combos[ m_dataTable-&gt;<a class="code" href="classItemDataTable.html#a5">getData</a>( itemID ) ];
00195    }
00196    
<a name="l00197"></a><a class="code" href="classItemComboTable.html#a11">00197</a>    <span class="keywordtype">void</span> <a class="code" href="classItemComboTable.html#a11">setValues</a>( <span class="keyword">const</span> VALUE_TYPE&amp; defaultVal,
00198                    <span class="keyword">const</span> itemMap_t&amp; itemsToAdd ) {
00199       <a class="code" href="classItemComboTable.html#a15">clear</a>();
00200       <span class="comment">// Get the combos</span>
00201       <span class="keyword">typedef</span> <a class="code" href="classmap.html">map&lt;VALUE_TYPE, uint32&gt;</a> comboMap_t;
00202       comboMap_t comboMap;
00203       <span class="keywordflow">for</span>( <span class="keyword">typename</span> itemMap_t::const_iterator it = itemsToAdd.begin();
00204            it != itemsToAdd.end();
00205            ++it ) {
00206          <span class="comment">// Always try to insert the URType, even if it is the default.</span>
00207          comboMap.insert( make_pair( it-&gt;second, comboMap.size() ) );
00208       }
00209       <span class="comment">// Also insert the default, if no-one has it.</span>
00210       comboMap.insert( make_pair( defaultVal, comboMap.size() ) );
00211       <span class="comment">// This is here because numeric_limits doesn't seem to exist.</span>
00212       <a class="code" href="Types_8h.html#a21">uint32</a> maxNbr = INTEGER_TYPE(-1) + 1;
00213       <span class="keywordflow">if</span> ( maxNbr == 0 ) {
00214          <span class="comment">// uint32 overflows, we'll miss one</span>
00215          maxNbr = MAX_UINT32;
00216       }
00217       
00218       <span class="keywordflow">if</span> ( ! itemsToAdd.empty() ) {
00219          <span class="comment">// Don't print this if not adding stuff.</span>
00220          <a class="code" href="MC2Logging_8h.html#a2">mc2dbg</a> &lt;&lt; <span class="stringliteral">"[ICT]: Nbr ur-type combinations: "</span>
00221                 &lt;&lt; comboMap.size() &lt;&lt; <span class="stringliteral">" of max "</span> &lt;&lt; maxNbr &lt;&lt; endl;
00222       }
00223       
00224       <span class="comment">// This is here because numeric_limits doesn't seem to exist.</span>
00225       <a class="code" href="config_8h.html#a29">MC2_ASSERT</a>( comboMap.size() &lt;= maxNbr );
00226       m_nbrCombos = comboMap.size();
00227       m_combos = <span class="keyword">new</span> VALUE_TYPE[ m_nbrCombos ];
00228       
00229       <span class="comment">// Fill in the combos</span>
00230       <span class="keywordflow">for</span> ( <span class="keyword">typename</span> comboMap_t::const_iterator it = comboMap.begin();
00231             it != comboMap.end();
00232             ++it ) {
00233          m_combos[ it-&gt;second ] = it-&gt;first;
00234       }
00235 
00236       <span class="comment">// Make the map for the other table.</span>
00237       <a class="code" href="classmap.html">otherMap_t</a> dataMap;
00238       <span class="keywordflow">for</span> ( <span class="keyword">typename</span> itemMap_t::const_iterator it = itemsToAdd.begin();
00239             it != itemsToAdd.end();
00240             ++it ) {
00241          <span class="keywordflow">if</span> ( it-&gt;second != defaultVal ) {
00242             dataMap.insert( make_pair( it-&gt;first, comboMap[it-&gt;second] ) );
00243          }
00244       }
00245       m_dataTable =
00246          <span class="keyword">new</span> <a class="code" href="classItemComboTable.html#y1">otherTable_t</a>(comboMap[defaultVal], dataMap );
00247       <span class="keywordflow">for</span> ( <span class="keyword">typename</span> itemMap_t::const_iterator it = itemsToAdd.begin();
00248             it != itemsToAdd.end();
00249             ++it ) {
00250          <a class="code" href="config_8h.html#a29">MC2_ASSERT</a>( <a class="code" href="classItemComboTable.html#a10">getData</a>( it-&gt;first ) == it-&gt;second );
00251       }
00252    }
00253 
<a name="l00254"></a><a class="code" href="classItemComboTable.html#a12">00254</a>    <a class="code" href="Types_8h.html#a21">uint32</a> <a class="code" href="classItemComboTable.html#a12">getSizeInDataBuffer</a>()<span class="keyword"> const </span>{
00255       <a class="code" href="Types_8h.html#a21">uint32</a> size = 4 + 4 + 4 + 4;
00256       <span class="keywordflow">for</span> ( <a class="code" href="Types_8h.html#a21">uint32</a> i = 0; i &lt; m_nbrCombos; ++i ) {
00257          size += VALUE_SAVER::getValSizeInDataBuffer( m_combos[i] );
00258       }
00259       <span class="comment">// Align to long</span>
00260       <a class="code" href="namespaceAlignUtility.html#a4">AlignUtility::alignLong</a>( size );
00261       size = size + m_dataTable-&gt;<a class="code" href="classItemDataTable.html#a11">getSizeInDataBuffer</a>();
00262       <span class="keywordflow">return</span> size;
00263    }
00264    
<a name="l00265"></a><a class="code" href="classItemComboTable.html#a13">00265</a>    <span class="keywordtype">void</span> <a class="code" href="classItemComboTable.html#a13">save</a>( <a class="code" href="classDataBuffer.html">DataBuffer</a>&amp; buf )<span class="keyword"> const </span>{
00266       <a class="code" href="classDataBufferChecker.html">DataBufferChecker</a> dbc( buf, <span class="stringliteral">"ItemComboTable::save"</span> );
00267       buf.<a class="code" href="classDataBuffer.html#a13">writeNextLong</a>( <a class="code" href="classItemComboTable.html#a12">getSizeInDataBuffer</a>() );
00268       buf.<a class="code" href="classDataBuffer.html#a13">writeNextLong</a>( 0 ); <span class="comment">// Version</span>
00269       buf.<a class="code" href="classDataBuffer.html#a13">writeNextLong</a>( m_nbrCombos );
00270       buf.<a class="code" href="classDataBuffer.html#a13">writeNextLong</a>( <span class="keyword">sizeof</span>( INTEGER_TYPE ) );
00271       <span class="keywordflow">for</span> ( <a class="code" href="Types_8h.html#a21">uint32</a> i = 0; i &lt; m_nbrCombos; ++i ) {
00272          VALUE_SAVER::writeValue( buf, m_combos[i] );
00273       }
00274       buf.<a class="code" href="classDataBuffer.html#a32">alignToLongAndClear</a>();
00275       m_dataTable-&gt;<a class="code" href="classItemDataTable.html#a12">save</a>( buf );
00276       dbc.<a class="code" href="classDataBufferChecker.html#a2">assertPosition</a>( <a class="code" href="classItemComboTable.html#a12">getSizeInDataBuffer</a>() );
00277       <a class="code" href="MC2Logging_8h.html#a2">mc2dbg</a> &lt;&lt; <span class="stringliteral">"[ICT]: Saved"</span> &lt;&lt; endl;
00278    }
00279 
<a name="l00280"></a><a class="code" href="classItemComboTable.html#a14">00280</a>    <span class="keywordtype">void</span> <a class="code" href="classItemComboTable.html#a14">load</a>( <a class="code" href="classDataBuffer.html">DataBuffer</a>&amp; inbuf ) {
00281       <a class="code" href="classItemComboTable.html#a15">clear</a>();
00282       <span class="comment">// Some tricks to make it easier</span>
00283       <span class="comment">// Read from a temporary buffer.</span>
00284       <a class="code" href="classDataBuffer.html">DataBuffer</a> buf( inbuf.<a class="code" href="classSharedBuffer.html#a29">getCurrentOffsetAddress</a>(),
00285                       inbuf.<a class="code" href="classSharedBuffer.html#a30">getNbrBytesLeft</a>() );
00286       <a class="code" href="Types_8h.html#a21">uint32</a> length = <a class="code" href="classItemComboTable.html#d0">int_load</a>( buf );
00287       <span class="comment">// Then skip unknown data</span>
00288       inbuf.<a class="code" href="classSharedBuffer.html#a32">readPastBytes</a>( length );
00289    }
00290    
<a name="l00292"></a><a class="code" href="classItemComboTable.html#a15">00292</a>    <span class="keywordtype">void</span> <a class="code" href="classItemComboTable.html#a15">clear</a>() {
00293       <span class="keyword">delete</span> [] m_combos;
00294       <span class="keyword">delete</span> m_dataTable;
00295       <a class="code" href="classItemComboTable.html#d1">init</a>();
00296    }
00297 
00298 <span class="keyword">private</span>:
<a name="l00299"></a><a class="code" href="classItemComboTable.html#d0">00299</a>    <a class="code" href="Types_8h.html#a21">uint32</a> <a class="code" href="classItemComboTable.html#d0">int_load</a>( <a class="code" href="classDataBuffer.html">DataBuffer</a>&amp; buf ) {
00300       
00301       <span class="keyword">const</span> <a class="code" href="Types_8h.html#a21">uint32</a> length = buf.<a class="code" href="classDataBuffer.html#a7">readNextLong</a>();
00302       buf.<a class="code" href="classDataBuffer.html#a7">readNextLong</a>(); <span class="comment">// Version</span>
00303       buf.<a class="code" href="classDataBuffer.html#a7">readNextLong</a>( m_nbrCombos );
00304 
00305       <a class="code" href="MC2Logging_8h.html#a2">mc2dbg</a> &lt;&lt; <span class="stringliteral">"[ICT]: load: Nbr combos = "</span> &lt;&lt; m_nbrCombos &lt;&lt; endl;
00306 
00307       <span class="keyword">const</span> <a class="code" href="Types_8h.html#a21">uint32</a> size_of_int = buf.<a class="code" href="classDataBuffer.html#a7">readNextLong</a>();
00308       m_combos = <span class="keyword">new</span> VALUE_TYPE[ m_nbrCombos ];
00309       <span class="keywordflow">for</span> ( <a class="code" href="Types_8h.html#a21">uint32</a> i = 0; i &lt; m_nbrCombos; ++i ) {
00310          VALUE_SAVER::readValue( buf, m_combos[i] );
00311       }
00312       
00313       buf.<a class="code" href="classDataBuffer.html#a33">alignToLong</a>();
00314       <span class="comment">// Create new datatable with the wrong default value.</span>
00315       <span class="comment">// Will be correct when loaded.</span>
00316       m_dataTable = <span class="keyword">new</span> <a class="code" href="classItemComboTable.html#y1">otherTable_t</a>(INTEGER_TYPE());
00317       <span class="keywordflow">switch</span> ( size_of_int ) {
00318          <span class="keywordflow">case</span> 1:
00319             <a class="code" href="MC2Logging_8h.html#a2">mc2dbg</a> &lt;&lt; <span class="stringliteral">"[ICT]: load: Loading uint8:s"</span> &lt;&lt; endl;
00320             m_dataTable-&gt;<a class="code" href="classItemDataTable.html#a13">load</a>( buf, (<a class="code" href="classItemComboLoader.html">ItemComboLoader&lt;uint8&gt;</a>*)NULL );
00321             <span class="keywordflow">break</span>;
00322          <span class="keywordflow">case</span> 2:
00323             <a class="code" href="MC2Logging_8h.html#a2">mc2dbg</a> &lt;&lt; <span class="stringliteral">"[ICT]: load: Loading uint16:s"</span> &lt;&lt; endl;
00324             m_dataTable-&gt;<a class="code" href="classItemDataTable.html#a13">load</a>( buf, (<a class="code" href="classItemComboLoader.html">ItemComboLoader&lt;uint16&gt;</a>*)NULL );
00325             <span class="keywordflow">break</span>;
00326          <span class="keywordflow">default</span>:
00327             <a class="code" href="MC2Logging_8h.html#a2">mc2dbg</a> &lt;&lt; <span class="stringliteral">"[ICT]: load: Loading uint32:s"</span> &lt;&lt; endl;
00328             m_dataTable-&gt;<a class="code" href="classItemDataTable.html#a13">load</a>( buf, (<a class="code" href="classItemComboLoader.html">ItemComboLoader&lt;uint32&gt;</a>*)NULL );
00329             <span class="keywordflow">break</span>;
00330       }
00331 
00332       <a class="code" href="MC2Logging_8h.html#a2">mc2dbg</a> &lt;&lt; <span class="stringliteral">"[ICT]: load: Read "</span> &lt;&lt; length &lt;&lt; <span class="stringliteral">" bytes"</span> &lt;&lt; endl;
00333 
00334       <span class="keywordflow">return</span> length;
00335    }
00336 
<a name="l00338"></a><a class="code" href="classItemComboTable.html#d1">00338</a>    <span class="keywordtype">void</span> <a class="code" href="classItemComboTable.html#d1">init</a>() {
00339       m_dataTable = NULL;
00340       m_combos = NULL;
00341       m_nbrCombos = 0;
00342    }
00343 
<a name="l00345"></a><a class="code" href="classItemComboTable.html#r0">00345</a>    VALUE_TYPE* m_combos;
<a name="l00347"></a><a class="code" href="classItemComboTable.html#r1">00347</a>    <a class="code" href="Types_8h.html#a21">uint32</a> m_nbrCombos;
<a name="l00349"></a><a class="code" href="classItemComboTable.html#r2">00349</a>    <a class="code" href="classItemDataTable.html">otherTable_t</a>* m_dataTable;
00350    
00351 };
00352 
00353 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jun 30 10:11:47 2010 for mc2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
