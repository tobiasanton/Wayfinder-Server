<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mc2: TileMapContainer.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">Shared</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">include</a></div>
<h1>TileMapContainer.h</h1><a href="TileMapContainer_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">Copyright (c) 1999 - 2010, Vodafone Group Services Ltd</span>
00003 <span class="comment">All rights reserved.</span>
00004 <span class="comment"></span>
00005 <span class="comment">Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
00008 <span class="comment">    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
00009 <span class="comment">    * Neither the name of the Vodafone Group Services Ltd nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
00010 <span class="comment"></span>
00011 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00012 <span class="comment">*/</span>
00013 
00014 <span class="preprocessor">#ifndef TILE_MAPCONTAINER_H</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define TILE_MAPCONTAINER_H</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#include "<a class="code" href="TileMap_8h.html">TileMap.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="TileMapParams_8h.html">TileMapParams.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="TileMapHandlerTypes_8h.html">TileMapHandlerTypes.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="LangTypes_8h.html">LangTypes.h</a>"</span>
00021 <span class="preprocessor">#include &lt;list&gt;</span>
00022 <span class="preprocessor">#include "<a class="code" href="RouteID_8h.html">RouteID.h</a>"</span>
00023 <span class="preprocessor">#include "<a class="code" href="TileMapFormatDesc_8h.html">TileMapFormatDesc.h</a>"</span>
00024 <span class="preprocessor">#include "<a class="code" href="MapProjection_8h.html">MapProjection.h</a>"</span>
00025 
00026 <span class="preprocessor">#include "<a class="code" href="TileMapGarbage_8h.html">TileMapGarbage.h</a>"</span>
00027 <span class="preprocessor">#include "<a class="code" href="ParamsNotice_8h.html">ParamsNotice.h</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="NotCopyable_8h.html">NotCopyable.h</a>"</span>
00029 
<a name="l00034"></a><a class="code" href="structlayerImp__t.html">00034</a> <span class="keyword">struct </span><a class="code" href="structlayerImp__t.html">layerImp_t</a> : <span class="keyword">public</span> pair&lt;int,int&gt;
00035 {
00041    <span class="keyword">inline</span> <a class="code" href="structlayerImp__t.html#a0">layerImp_t</a>( <span class="keyword">const</span> <a class="code" href="classTileMapParams.html">TileMapParams</a>&amp; param,
00042                       <span class="keyword">const</span> <a class="code" href="classTileMapFormatDesc.html">TileMapFormatDesc</a>&amp; mapDesc );
00043 };
00044 
00045 
00046 <span class="comment">// ----------------------- MapStorage -------------------------</span>
00047 
<a name="l00051"></a><a class="code" href="structMapStorage.html">00051</a> <span class="keyword">struct </span><a class="code" href="structMapStorage.html">MapStorage</a>: <span class="keyword">private</span> <a class="code" href="classNotCopyable.html">NotCopyable</a> {
00052 
00058    <a class="code" href="structMapStorage.html#a0">MapStorage</a>( <span class="keywordtype">bool</span> containsStrings, <a class="code" href="classTileMapGarbage.html">TileMapGarbage&lt;TileMap&gt;</a>* garbage ); 
00059    
00063    <a class="code" href="structMapStorage.html#a1">~MapStorage</a>();
00064    
00069    <span class="keywordtype">void</span> <a class="code" href="structMapStorage.html#a2">swap</a>( <a class="code" href="structMapStorage.html">MapStorage</a>&amp; other );
00070 
00082    <span class="keywordtype">int</span> <a class="code" href="structMapStorage.html#a3">getCoverage</a>( <span class="keyword">const</span> <a class="code" href="structlayerImp__t.html">layerImp_t</a>&amp; imp, 
00083                     <span class="keyword">const</span> <a class="code" href="structParamsNotice.html">ParamsNotice</a>&amp; params,
00084                     <span class="keyword">const</span> <a class="code" href="classMapProjection.html">MapProjection</a>&amp; projection,
00085                     <span class="keyword">const</span> <a class="code" href="classTileMapFormatDesc.html">TileMapFormatDesc</a>&amp; mapDesc ) <span class="keyword">const</span>;
00086    
00092    <span class="keywordtype">int</span> <a class="code" href="structMapStorage.html#a4">getStrIdx</a>( <span class="keywordtype">int</span> index ) <span class="keyword">const</span>;
00093 
00099    <span class="keywordtype">int</span> <a class="code" href="structMapStorage.html#a5">getMapIdx</a>( <span class="keywordtype">int</span> strIdx ) <span class="keyword">const</span>;
00100 
00106    <span class="keywordtype">int</span> <a class="code" href="structMapStorage.html#a6">getMapIndex</a>( <span class="keyword">const</span> <a class="code" href="classTileMapParams.html">TileMapParams</a>&amp; param ) <span class="keyword">const</span>;
00107    
00113    <span class="keywordtype">void</span> <a class="code" href="structMapStorage.html#a7">updateMapsFrom</a>( <a class="code" href="structMapStorage.html">MapStorage</a>&amp; other );
00114             
00121    <span class="keywordtype">void</span> <a class="code" href="structMapStorage.html#a8">takeImportance</a>( <a class="code" href="structMapStorage.html">MapStorage</a>&amp; other, <span class="keyword">const</span> <a class="code" href="structlayerImp__t.html">layerImp_t</a>&amp; imp );
00122 
00126    <span class="keywordtype">void</span> <a class="code" href="structMapStorage.html#a9">updateImportances</a>();
00127 
00133    <span class="keywordtype">void</span> <a class="code" href="structMapStorage.html#a10">clear</a>( <span class="keyword">const</span> <a class="code" href="structlayerImp__t.html">layerImp_t</a>* imp = NULL );
00134 
00139    <span class="keywordtype">void</span> <a class="code" href="structMapStorage.html#a11">setMapDesc</a>( <span class="keyword">const</span> <a class="code" href="classTileMapFormatDesc.html">TileMapFormatDesc</a>* mapDesc );
00140    
<a name="l00144"></a><a class="code" href="structMapStorage.html#o0">00144</a>    <a class="code" href="classvector.html">vector&lt;TileMapParams&gt;</a> m_params;
00145    
<a name="l00149"></a><a class="code" href="structMapStorage.html#o1">00149</a>    <a class="code" href="classvector.html">vector&lt;TileMap*&gt;</a> m_maps;
00150    
<a name="l00154"></a><a class="code" href="structMapStorage.html#w0">00154</a>    <span class="keyword">typedef</span> pair&lt;int, int&gt; range_t;
00155    
<a name="l00162"></a><a class="code" href="structMapStorage.html#o2">00162</a>    <a class="code" href="classmap.html">map&lt;layerImp_t, range_t&gt;</a> m_importances;
00163 
<a name="l00167"></a><a class="code" href="structMapStorage.html#o3">00167</a>    <span class="keywordtype">bool</span> m_containsStrings;
00168   
<a name="l00172"></a><a class="code" href="structMapStorage.html#o4">00172</a>    <span class="keyword">const</span> <a class="code" href="classTileMapFormatDesc.html">TileMapFormatDesc</a>* m_mapDesc;
00173   
<a name="l00177"></a><a class="code" href="structMapStorage.html#o5">00177</a>    <a class="code" href="classTileMapGarbage.html">TileMapGarbage&lt;TileMap&gt;</a>* m_garbage;
00178    
<a name="l00184"></a><a class="code" href="structMapStorage.html#a12">00184</a>    <a class="code" href="classTileMap.html">TileMap</a>* <a class="code" href="structMapStorage.html#a12">getMap</a>( uint32 i )<span class="keyword"> const </span>{
00185       <span class="keywordflow">if</span> ( i &lt; <a class="code" href="structMapStorage.html#o1">m_maps</a>.size() ) {
00186          <span class="keywordflow">return</span> <a class="code" href="structMapStorage.html#o1">m_maps</a>[ i ];
00187       }
00188       <span class="keywordflow">return</span> NULL;
00189    }
00190    
<a name="l00194"></a><a class="code" href="structMapStorage.html#a13">00194</a>    <span class="keywordtype">void</span> <a class="code" href="structMapStorage.html#a13">cleanUp</a>() {
00195       <span class="keywordflow">if</span> ( <a class="code" href="structMapStorage.html#o2">m_importances</a>.empty() ) {
00196 <span class="preprocessor">#ifdef MC2_SYSTEM         </span>
00197 <span class="preprocessor"></span>         <span class="comment">// Make sure all the maps are NULL.</span>
00198          <span class="keywordflow">for</span> ( <a class="code" href="Types_8h.html#a21">uint32</a> i = 0; i &lt; <a class="code" href="structMapStorage.html#o1">m_maps</a>.size(); ++i ) {
00199             <a class="code" href="config_8h.html#a29">MC2_ASSERT</a>( <a class="code" href="structMapStorage.html#o1">m_maps</a>[ i ] == NULL );
00200          }
00201 <span class="preprocessor">#endif         </span>
00202 <span class="preprocessor"></span>         <a class="code" href="structMapStorage.html#o0">m_params</a>.clear();
00203          <a class="code" href="structMapStorage.html#o1">m_maps</a>.clear();
00204       }
00205    }
00206    
<a name="l00210"></a><a class="code" href="structMapStorage.html#a14">00210</a>    <span class="keywordtype">void</span> <a class="code" href="structMapStorage.html#a14">dump</a>() {
00211       <a class="code" href="MC2Logging_8h.html#a0">mc2log</a> &lt;&lt; <span class="stringliteral">"MapStorage: dump"</span> &lt;&lt; endl;
00212       <span class="keywordflow">for</span> ( <a class="code" href="classmap.html">map&lt;layerImp_t, range_t&gt;</a>::const_iterator it = 
00213             <a class="code" href="structMapStorage.html#o2">m_importances</a>.begin(); it != <a class="code" href="structMapStorage.html#o2">m_importances</a>.end(); ++it ) {
00214          <a class="code" href="structMapStorage.html#a14">dump</a>( (*it).first );
00215       }
00216       <span class="keywordflow">for</span> ( <a class="code" href="Types_8h.html#a21">uint32</a> i = 0; i &lt; <a class="code" href="structMapStorage.html#o0">m_params</a>.size(); ++i ) {
00217          <a class="code" href="MC2Logging_8h.html#a0">mc2log</a> &lt;&lt; <span class="stringliteral">"Param = "</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">" - "</span> &lt;&lt; <a class="code" href="structMapStorage.html#o0">m_params</a>[ i ].getAsString();
00218          <span class="keywordflow">if</span> ( <a class="code" href="structMapStorage.html#a12">getMap</a>( i ) != NULL ) {
00219             <a class="code" href="MC2Logging_8h.html#a0">mc2log</a> &lt;&lt; <span class="stringliteral">" not NULL "</span> &lt;&lt; endl;
00220          } <span class="keywordflow">else</span> {
00221             <a class="code" href="MC2Logging_8h.html#a0">mc2log</a> &lt;&lt; <span class="stringliteral">" NULL"</span> &lt;&lt; endl;
00222          }
00223       }
00224    }
00225    
<a name="l00229"></a><a class="code" href="structMapStorage.html#a15">00229</a>    <span class="keywordtype">void</span> <a class="code" href="structMapStorage.html#a14">dump</a>( <span class="keyword">const</span> <a class="code" href="structlayerImp__t.html">layerImp_t</a>&amp; imp ) {
00230       <a class="code" href="classmap.html">map&lt;layerImp_t, range_t&gt;</a>::const_iterator findit = 
00231          <a class="code" href="structMapStorage.html#o2">m_importances</a>.find( imp );
00232       <span class="keywordflow">if</span> ( findit != <a class="code" href="structMapStorage.html#o2">m_importances</a>.end() ) {
00233          <a class="code" href="MC2Logging_8h.html#a0">mc2log</a> &lt;&lt; <span class="stringliteral">"MapStorage: dump - layerImp_t "</span> &lt;&lt; imp.first &lt;&lt; <span class="stringliteral">", "</span>
00234             &lt;&lt; imp.second &lt;&lt; <span class="stringliteral">" - range "</span> &lt;&lt; findit-&gt;second.first 
00235             &lt;&lt; <span class="stringliteral">" - "</span> &lt;&lt; findit-&gt;second.second &lt;&lt; endl;
00236          <a class="code" href="MC2Logging_8h.html#a0">mc2log</a> &lt;&lt; <span class="stringliteral">"Size of maps = "</span> &lt;&lt; <a class="code" href="structMapStorage.html#o1">m_maps</a>.size() &lt;&lt; endl;
00237       } <span class="keywordflow">else</span> {
00238          <a class="code" href="MC2Logging_8h.html#a0">mc2log</a> &lt;&lt; <span class="stringliteral">"MapStorage: dump - layerImp_t "</span> &lt;&lt; imp.first &lt;&lt; <span class="stringliteral">", "</span>
00239             &lt;&lt; imp.second &lt;&lt; <span class="stringliteral">" - Not found."</span> &lt;&lt; endl;
00240       }
00241    }
00242 
00243 };
00244 
00245 <span class="comment">// ----------------------- TileMapContainer -------------------------</span>
00246 <span class="keyword">class </span><a class="code" href="classMapsToDrawIt.html">MapsToDrawIt</a>;
00247 <span class="keyword">class </span><a class="code" href="classParamsToDrawIt.html">ParamsToDrawIt</a>;
00248 
<a name="l00252"></a><a class="code" href="classTileMapContainer.html">00252</a> <span class="keyword">class </span><a class="code" href="classTileMapContainer.html">TileMapContainer</a>: <span class="keyword">private</span> <a class="code" href="classNotCopyable.html">NotCopyable</a> {
00253       
00254    <span class="keyword">public</span>:
00255 
<a name="l00257"></a><a class="code" href="classTileMapContainer.html#n0">00257</a>       <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classTileMapFormatDesc.html">TileMapFormatDesc</a>;
<a name="l00258"></a><a class="code" href="classTileMapContainer.html#w0">00258</a>       <span class="keyword">typedef</span> MapStorage::range_t range_t;
00259       
00265       <a class="code" href="classTileMapContainer.html#a0">TileMapContainer</a>( <span class="keyword">const</span> <a class="code" href="classMapProjection.html">MapProjection</a>* projection,
00266                         <a class="code" href="classTileMapGarbage.html">TileMapGarbage&lt;TileMap&gt;</a>* garbage );
00267 
00271       <a class="code" href="classTileMapContainer.html#a1">~TileMapContainer</a>();
00272      
00277       <span class="keywordtype">void</span> <a class="code" href="classTileMapContainer.html#a2">setMapDesc</a>( <span class="keyword">const</span> <a class="code" href="classTileMapFormatDesc.html">TileMapFormatDesc</a>* mapDesc );
00278 
<a name="l00282"></a><a class="code" href="classTileMapContainer.html#w1">00282</a>       <span class="keyword">typedef</span> <a class="code" href="classvector.html">vector&lt;TileMap*&gt;</a>::const_iterator MIt;
00283 
<a name="l00287"></a><a class="code" href="classTileMapContainer.html#w2">00287</a>       <span class="keyword">typedef</span> <a class="code" href="classvector.html">vector&lt;TileMapParams&gt;</a>::const_iterator PIt;
00288       
<a name="l00292"></a><a class="code" href="classTileMapContainer.html#a3">00292</a>       <a class="code" href="classTileMapContainer.html#w1">MIt</a> <a class="code" href="classTileMapContainer.html#a3">beginMapsToReq</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classTileMapContainer.html#o0">m_mapsToReq</a>.<a class="code" href="structMapStorage.html#o1">m_maps</a>.begin(); }
00293       
<a name="l00297"></a><a class="code" href="classTileMapContainer.html#a4">00297</a>       <a class="code" href="classTileMapContainer.html#w1">MIt</a> <a class="code" href="classTileMapContainer.html#a4">endMapsToReq</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classTileMapContainer.html#o0">m_mapsToReq</a>.<a class="code" href="structMapStorage.html#o1">m_maps</a>.end(); }
00298      
<a name="l00302"></a><a class="code" href="classTileMapContainer.html#a5">00302</a>       <a class="code" href="classTileMapContainer.html#w2">PIt</a> <a class="code" href="classTileMapContainer.html#a5">beginParamsToReq</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classTileMapContainer.html#o0">m_mapsToReq</a>.<a class="code" href="structMapStorage.html#o0">m_params</a>.begin(); }
00303       
<a name="l00307"></a><a class="code" href="classTileMapContainer.html#a6">00307</a>       <a class="code" href="classTileMapContainer.html#w2">PIt</a> <a class="code" href="classTileMapContainer.html#a6">endParamsToReq</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classTileMapContainer.html#o0">m_mapsToReq</a>.<a class="code" href="structMapStorage.html#o0">m_params</a>.end(); }
00308      
<a name="l00312"></a><a class="code" href="classTileMapContainer.html#a7">00312</a>       <a class="code" href="classTileMapContainer.html#w1">MIt</a> <a class="code" href="classTileMapContainer.html#a7">beginReserveMapsToReq</a>()<span class="keyword"> const </span>{ 
00313          <span class="keywordflow">return</span> <a class="code" href="classTileMapContainer.html#o2">m_reserveMaps</a>.<a class="code" href="structMapStorage.html#o1">m_maps</a>.begin(); }
00314       
<a name="l00318"></a><a class="code" href="classTileMapContainer.html#a8">00318</a>       <a class="code" href="classTileMapContainer.html#w1">MIt</a> <a class="code" href="classTileMapContainer.html#a8">endReserveMapsToReq</a>()<span class="keyword"> const </span>{ 
00319          <span class="keywordflow">return</span> <a class="code" href="classTileMapContainer.html#o2">m_reserveMaps</a>.<a class="code" href="structMapStorage.html#o1">m_maps</a>.end(); }
00320      
<a name="l00324"></a><a class="code" href="classTileMapContainer.html#a9">00324</a>       <a class="code" href="classTileMapContainer.html#w2">PIt</a> <a class="code" href="classTileMapContainer.html#a9">beginReserveParamsToReq</a>()<span class="keyword"> const </span>{ 
00325          <span class="keywordflow">return</span> <a class="code" href="classTileMapContainer.html#o2">m_reserveMaps</a>.<a class="code" href="structMapStorage.html#o0">m_params</a>.begin(); }
00326       
<a name="l00330"></a><a class="code" href="classTileMapContainer.html#a10">00330</a>       <a class="code" href="classTileMapContainer.html#w2">PIt</a> <a class="code" href="classTileMapContainer.html#a10">endReserveParamsToReq</a>()<span class="keyword"> const </span>{ 
00331          <span class="keywordflow">return</span> <a class="code" href="classTileMapContainer.html#o2">m_reserveMaps</a>.<a class="code" href="structMapStorage.html#o0">m_params</a>.end(); }
00332      
00337       <span class="keyword">inline</span> <a class="code" href="classTileMap.html">TileMap</a>* <a class="code" href="classTileMapContainer.html#a11">getMap</a>(<span class="keyword">const</span> <a class="code" href="classMC2SimpleString.html">MC2SimpleString</a>&amp; desc) <span class="keyword">const</span>;
00338    
00339      
00353       <span class="keywordtype">int</span> <a class="code" href="classTileMapContainer.html#a12">addMap</a>( <span class="keyword">const</span> <a class="code" href="classTileMapParams.html">TileMapParams</a>&amp; params,
00354             <a class="code" href="classBitBuffer.html">BitBuffer</a>&amp; buffer, 
00355             <a class="code" href="structMapStorage.html">MapStorage</a>&amp; mapStorage,
00356             <a class="code" href="classvector.html">vector&lt;TileMapParams&gt;</a>&amp; removeFromCache,
00357             <span class="keywordtype">bool</span> replaceExistingMaps = <span class="keyword">true</span> );
00358 
00369       <a class="code" href="classMapsToDrawIt.html">MapsToDrawIt</a> <a class="code" href="classTileMapContainer.html#a12">addMap</a>( <span class="keyword">const</span> <a class="code" href="classMC2SimpleString.html">MC2SimpleString</a>&amp; params, 
00370                            <a class="code" href="classBitBuffer.html">BitBuffer</a>&amp; buffer,
00371                            <a class="code" href="classvector.html">vector&lt;TileMapParams&gt;</a>&amp; removeFromCache );
00372 
00386       <span class="keywordtype">bool</span> <a class="code" href="classTileMapContainer.html#a14">updateParams</a>( <a class="code" href="classTileMapFormatDesc.html">TileMapFormatDesc</a>&amp; mapFormatDesc,
00387                          <span class="keyword">const</span> <a class="code" href="classMapProjection.html">MapProjection</a>&amp; projection,
00388                          <span class="keywordtype">bool</span> useGzip,
00389                          LangTypes::language_t lang,
00390                          <span class="keyword">const</span> set&lt;int&gt;&amp; layersToDisplay,
00391                          <span class="keyword">const</span> <a class="code" href="classRouteID.html">RouteID</a>* routeID = NULL );
00392 
00398       <span class="keywordtype">void</span> <a class="code" href="classTileMapContainer.html#a15">paramsUpdated</a>( <span class="keyword">const</span> <a class="code" href="classvector.html">vector&lt;TileMapParams&gt;</a>&amp; newParams,
00399             <span class="keyword">const</span> <a class="code" href="classvector.html">vector&lt;TileMapParams&gt;</a>&amp; reserveParams );
00400   
<a name="l00404"></a><a class="code" href="classTileMapContainer.html#w8">00404</a>       <span class="keyword">enum</span> <a class="code" href="classTileMapContainer.html#w8">mapStorage_t</a> {
00405          mapsToReq_t, 
00406          oldMaps_t,
00407          reserveMaps_t,
00408          <a class="code" href="classTileMapContainer.html#w8w7">prevMaps_t</a>
00409       };
00410 
00424       mapStorage_t <a class="code" href="classTileMapContainer.html#a16">getBestCoverage</a>( <span class="keyword">const</span> <a class="code" href="structlayerImp__t.html">layerImp_t</a>&amp; imp,
00425                                     <span class="keyword">const</span> <a class="code" href="structMapStorage.html">MapStorage</a>&amp; mapsToReq,
00426                                     <span class="keyword">const</span> <a class="code" href="structMapStorage.html">MapStorage</a>&amp; oldMaps,
00427                                     <span class="keyword">const</span> <a class="code" href="structMapStorage.html">MapStorage</a>&amp; reserveMaps,
00428                                     <span class="keyword">const</span> <a class="code" href="structMapStorage.html">MapStorage</a>* prevMaps = NULL );
00429 
00435       <span class="keywordtype">void</span> <a class="code" href="classTileMapContainer.html#a17">setMapsToDraw</a>( <a class="code" href="structMapStorage.html">MapStorage</a>&amp; maps, 
00436                           <span class="keyword">const</span> <a class="code" href="structlayerImp__t.html">layerImp_t</a>&amp; imp );
00437    
00444       <span class="keywordtype">bool</span> <a class="code" href="classTileMapContainer.html#a18">updateMapsToDraw</a>( <span class="keyword">const</span> <a class="code" href="classTileMapParams.html">TileMapParams</a>&amp; param,
00445                              <a class="code" href="structMapStorage.html">MapStorage</a>&amp; maps );
00446    
<a name="l00450"></a><a class="code" href="classTileMapContainer.html#e0">00450</a>       <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="classTileMapContainer.html#e0">fullCoverage</a>( <span class="keywordtype">int</span> coverage ) { 
00451          <span class="keywordflow">return</span> coverage == MAX_INT16; }
00452 
<a name="l00456"></a><a class="code" href="classTileMapContainer.html#o0">00456</a>       <a class="code" href="structMapStorage.html">MapStorage</a> m_mapsToReq;
00457 
<a name="l00462"></a><a class="code" href="classTileMapContainer.html#o1">00462</a>       <a class="code" href="structMapStorage.html">MapStorage</a> m_oldMaps;
00463 
<a name="l00468"></a><a class="code" href="classTileMapContainer.html#o2">00468</a>       <a class="code" href="structMapStorage.html">MapStorage</a> m_reserveMaps;
00469 
<a name="l00473"></a><a class="code" href="classTileMapContainer.html#o3">00473</a>       <a class="code" href="classmap.html">map&lt;uint32, ParamsNotice&gt;</a> m_paramsByLayerNbr;
00474 
<a name="l00478"></a><a class="code" href="classTileMapContainer.html#o4">00478</a>       <span class="keyword">const</span> <a class="code" href="classTileMapFormatDesc.html">TileMapFormatDesc</a>* m_mapDesc;
00479 
<a name="l00483"></a><a class="code" href="classTileMapContainer.html#o5">00483</a>       <span class="keyword">const</span> <a class="code" href="classMapProjection.html">MapProjection</a>* m_projection;
00484 
<a name="l00488"></a><a class="code" href="classTileMapContainer.html#o6">00488</a>       <a class="code" href="classTileMapGarbage.html">TileMapGarbage&lt;TileMap&gt;</a>* m_garbage;
00489      
<a name="l00494"></a><a class="code" href="classTileMapContainer.html#w3">00494</a>       <span class="keyword">typedef</span> <a class="code" href="classmap.html">map&lt;layerImp_t, MapStorage*&gt;</a> <a class="code" href="classmap.html">mapsToDraw_t</a>;
00495 
<a name="l00499"></a><a class="code" href="classTileMapContainer.html#o7">00499</a>       <a class="code" href="classmap.html">mapsToDraw_t</a> m_mapsToDraw;
00500      
00504       <a class="code" href="classMapsToDrawIt.html">MapsToDrawIt</a> <a class="code" href="classTileMapContainer.html#a19">beginMapsToDraw</a>() <span class="keyword">const</span>;
00505       
00509       <a class="code" href="classMapsToDrawIt.html">MapsToDrawIt</a> <a class="code" href="classTileMapContainer.html#a20">endMapsToDraw</a>() <span class="keyword">const</span>;
00510 
00514       <a class="code" href="classParamsToDrawIt.html">ParamsToDrawIt</a> <a class="code" href="classTileMapContainer.html#a21">beginParamsToDraw</a>() <span class="keyword">const</span>;
00515       
00519       <a class="code" href="classParamsToDrawIt.html">ParamsToDrawIt</a> <a class="code" href="classTileMapContainer.html#a22">endParamsToDraw</a>() <span class="keyword">const</span>;
00520 
00524       <span class="keywordtype">void</span> <a class="code" href="classTileMapContainer.html#a23">dumpMapsToDraw</a>();      
00525 
00529       <span class="keywordtype">bool</span> <a class="code" href="classTileMapContainer.html#a24">reserveMapsComplete</a>() <span class="keyword">const</span>;
00530 
<a name="l00534"></a><a class="code" href="classTileMapContainer.html#o8">00534</a>       <span class="keywordtype">bool</span> m_reserveMapsComplete;
00535 
<a name="l00539"></a><a class="code" href="classTileMapContainer.html#o9">00539</a>       <a class="code" href="Types_8h.html#a21">uint32</a> m_nbrReserveMaps;
00540 
00541 };
00542 
00543 <span class="comment">// ----------------------- ToDrawIterator -------------------------</span>
00544 
<a name="l00548"></a><a class="code" href="classToDrawIterator.html">00548</a> <span class="keyword">class </span><a class="code" href="classToDrawIterator.html">ToDrawIterator</a> {
00549 <span class="keyword">public</span>:
<a name="l00550"></a><a class="code" href="classToDrawIterator.html#w0">00550</a>    <span class="keyword">typedef</span> <a class="code" href="classmap.html">TileMapContainer::mapsToDraw_t</a> <a class="code" href="classmap.html">mapsToDraw_t</a>;
00551    
<a name="l00558"></a><a class="code" href="classToDrawIterator.html#a0">00558</a>    <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>( <span class="keyword">const</span> mapsToDraw_t* mapsToDraw, <span class="keywordtype">bool</span> begin ) 
00559          : m_mapsToDraw( mapsToDraw ) {
00560       <span class="keywordflow">if</span> ( begin ) {
00561          m_mapsToDrawIt = m_mapsToDraw-&gt;begin();
00562          <span class="keywordflow">if</span> ( m_mapsToDrawIt == m_mapsToDraw-&gt;end() ) {
00563             m_idx = 0; <span class="comment">// end()</span>
00564          } <span class="keywordflow">else</span> {
00565             m_curRange = getRange();
00566             m_idx = m_curRange.first;
00567          }
00568       } <span class="keywordflow">else</span> {
00569          <span class="comment">// end()</span>
00570          m_mapsToDrawIt = mapsToDraw-&gt;end();
00571          m_idx = 0;
00572       }
00573    }
00574 
<a name="l00582"></a><a class="code" href="classToDrawIterator.html#a1">00582</a>    <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>( <span class="keyword">const</span> mapsToDraw_t* mapsToDraw, 
00583                    mapsToDraw_t::const_iterator&amp; it,
00584                    <span class="keywordtype">int</span> index ) 
00585          : m_mapsToDraw( mapsToDraw ),
00586            m_mapsToDrawIt( it ),
00587            m_idx( index ) {}
00588 
<a name="l00592"></a><a class="code" href="classToDrawIterator.html#a2">00592</a>    <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>( <span class="keyword">const</span> <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>&amp; other )
00593          : m_mapsToDraw( other.m_mapsToDraw ), 
00594            m_mapsToDrawIt( other.m_mapsToDrawIt ),
00595            m_idx( other.m_idx ) {}
00596 
<a name="l00600"></a><a class="code" href="classToDrawIterator.html#a3">00600</a>    <span class="keywordtype">bool</span> <a class="code" href="namespaceSTLUtility.html#a31">operator==</a>(<span class="keyword">const</span> <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>&amp; other)<span class="keyword"> const </span>{
00601       <a class="code" href="config_8h.html#a29">MC2_ASSERT</a>( m_mapsToDraw == other.<a class="code" href="classToDrawIterator.html#p0">m_mapsToDraw</a> );
00602       <span class="keywordflow">return</span> ( other.<a class="code" href="classToDrawIterator.html#p1">m_mapsToDrawIt</a> == m_mapsToDrawIt ) &amp;&amp;
00603              ( other.<a class="code" href="classToDrawIterator.html#p2">m_idx</a> == m_idx );
00604    }
00605 
<a name="l00609"></a><a class="code" href="classToDrawIterator.html#a4">00609</a>    <span class="keywordtype">bool</span> <a class="code" href="namespaceSTLUtility.html#a33">operator!=</a>(<span class="keyword">const</span> <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>&amp; other)<span class="keyword"> const </span>{
00610       <span class="keywordflow">return</span> ! (other == *<span class="keyword">this</span>);
00611    }
00612    
<a name="l00616"></a><a class="code" href="classToDrawIterator.html#a5">00616</a>    <span class="keyword">const</span> <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>&amp; operator++() {
00617       ++m_idx;
00618       <span class="keywordflow">if</span> ( m_idx &gt;= m_curRange.second ) {
00619          ++m_mapsToDrawIt;
00620          <span class="keywordflow">if</span> ( m_mapsToDrawIt != m_mapsToDraw-&gt;end() ) {
00621             m_curRange = getRange();
00622             m_idx = m_curRange.first;
00623          } <span class="keywordflow">else</span> {
00624             m_idx = 0; <span class="comment">// end()</span>
00625          }
00626       }
00627       <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00628    }
00629 
<a name="l00633"></a><a class="code" href="classToDrawIterator.html#a6">00633</a>    <a class="code" href="classToDrawIterator.html">ToDrawIterator</a> operator++(<span class="keywordtype">int</span>) {
00634       <a class="code" href="classToDrawIterator.html">ToDrawIterator</a> tmp(*<span class="keyword">this</span>);
00635       ++(*this);
00636       <span class="keywordflow">return</span> tmp;
00637    }
00638   
<a name="l00643"></a><a class="code" href="classToDrawIterator.html#a7">00643</a>    <a class="code" href="classTileMap.html">TileMap</a>* getStringMap()<span class="keyword"> const </span>{
00644       <span class="keyword">const</span> <a class="code" href="structMapStorage.html">MapStorage</a>* mapStorage = (*m_mapsToDrawIt).second;
00645       <span class="keywordflow">if</span> ( mapStorage-&gt;<a class="code" href="structMapStorage.html#o3">m_containsStrings</a> ) {
00646          <span class="keywordtype">int</span> strIdx = mapStorage-&gt;<a class="code" href="structMapStorage.html#a4">getStrIdx</a>( m_idx );
00647          <span class="keywordflow">return</span> mapStorage-&gt;<a class="code" href="structMapStorage.html#o1">m_maps</a>[ strIdx ];
00648       } <span class="keywordflow">else</span> {
00649          <span class="keywordflow">return</span> NULL;
00650       }
00651    }
00652    
00656 <span class="comment">//   bool operator &lt; ( const ToDrawIterator&amp; other ) {</span>
00657 <span class="comment">//      MC2_ASSERT( m_mapsToDraw == other.m_mapsToDraw );</span>
00658 <span class="comment">//   }</span>
00659    
00660 <span class="keyword">protected</span>:
00661 
<a name="l00662"></a><a class="code" href="classToDrawIterator.html#x0">00662</a>    <span class="keyword">typedef</span> MapStorage::range_t range_t;
00663    
<a name="l00667"></a><a class="code" href="classToDrawIterator.html#b0">00667</a>    range_t getRange() {
00668       <span class="keywordflow">return</span> (*m_mapsToDrawIt).second-&gt;<a class="code" href="structMapStorage.html#o2">m_importances</a>.find( 
00669                   (*m_mapsToDrawIt).first )-&gt;second;
00670    }
00671 
<a name="l00673"></a><a class="code" href="classToDrawIterator.html#p0">00673</a>    <span class="keyword">const</span> mapsToDraw_t* m_mapsToDraw;
00674 
<a name="l00676"></a><a class="code" href="classToDrawIterator.html#p1">00676</a>    mapsToDraw_t::const_iterator m_mapsToDrawIt;
00677    
<a name="l00679"></a><a class="code" href="classToDrawIterator.html#p2">00679</a>    <span class="keywordtype">int</span> m_idx;
00680   
<a name="l00682"></a><a class="code" href="classToDrawIterator.html#p3">00682</a>    range_t m_curRange;
00683 };
00684 
00685 <span class="comment">// Forward.</span>
00686 <span class="keyword">class </span><a class="code" href="classParamsToDrawIt.html">ParamsToDrawIt</a>;
00687 
<a name="l00691"></a><a class="code" href="classMapsToDrawIt.html">00691</a> <span class="keyword">class </span><a class="code" href="classMapsToDrawIt.html">MapsToDrawIt</a> : <span class="keyword">public</span> <a class="code" href="classToDrawIterator.html">ToDrawIterator</a> {
00692 <span class="keyword">public</span>:
<a name="l00699"></a><a class="code" href="classMapsToDrawIt.html#a0">00699</a>    <a class="code" href="classMapsToDrawIt.html#a0">MapsToDrawIt</a>( <span class="keyword">const</span> mapsToDraw_t* mapsToDraw, <span class="keywordtype">bool</span> begin )
00700       : <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>( mapsToDraw, begin ) {}
00701 
<a name="l00709"></a><a class="code" href="classMapsToDrawIt.html#a1">00709</a>    <a class="code" href="classMapsToDrawIt.html#a0">MapsToDrawIt</a>( <span class="keyword">const</span> mapsToDraw_t* mapsToDraw, 
00710                  mapsToDraw_t::const_iterator&amp; it,
00711                  <span class="keywordtype">int</span> index ) : <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>( mapsToDraw, it, index ) {}
00712            
<a name="l00716"></a><a class="code" href="classMapsToDrawIt.html#a2">00716</a>    <a class="code" href="classMapsToDrawIt.html#a0">MapsToDrawIt</a>( <span class="keyword">const</span> <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>&amp; toDrawIt ) 
00717       : <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>( toDrawIt ) {}
00718 
<a name="l00723"></a><a class="code" href="classMapsToDrawIt.html#a3">00723</a>    <a class="code" href="classTileMap.html">TileMap</a>* <a class="code" href="classMapsToDrawIt.html#a3">operator *</a>()<span class="keyword"> const </span>{
00724       <span class="keywordflow">return</span> (*m_mapsToDrawIt).second-&gt;m_maps[ m_idx ];
00725    }
00726 };
00727 
<a name="l00731"></a><a class="code" href="classParamsToDrawIt.html">00731</a> <span class="keyword">class </span><a class="code" href="classParamsToDrawIt.html">ParamsToDrawIt</a> : <span class="keyword">public</span> <a class="code" href="classToDrawIterator.html">ToDrawIterator</a> {
00732 <span class="keyword">public</span>:
<a name="l00739"></a><a class="code" href="classParamsToDrawIt.html#a0">00739</a>    <a class="code" href="classParamsToDrawIt.html#a0">ParamsToDrawIt</a>( <span class="keyword">const</span> mapsToDraw_t* mapsToDraw, <span class="keywordtype">bool</span> begin ) 
00740       : <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>( mapsToDraw, begin ) {}
00741 
<a name="l00749"></a><a class="code" href="classParamsToDrawIt.html#a1">00749</a>    <a class="code" href="classParamsToDrawIt.html#a0">ParamsToDrawIt</a>( <span class="keyword">const</span> <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>&amp; toDrawIt ) 
00750       : <a class="code" href="classToDrawIterator.html">ToDrawIterator</a>( toDrawIt ) {}
00751 
<a name="l00756"></a><a class="code" href="classParamsToDrawIt.html#a2">00756</a>    <a class="code" href="classTileMapParams.html">TileMapParams</a>&amp; <a class="code" href="classParamsToDrawIt.html#a2">operator *</a>()<span class="keyword"> const </span>{
00757       <span class="keywordflow">return</span> (*m_mapsToDrawIt).second-&gt;m_params[ m_idx ];
00758    }
00759 };
00760 
00761 
00762 <span class="comment">// --- Implementation of inlined methods ---</span>
00763 
00764 <span class="keyword">inline</span> 
<a name="l00765"></a><a class="code" href="structlayerImp__t.html#a0">00765</a> <a class="code" href="structlayerImp__t.html#a0">layerImp_t::layerImp_t</a>( <span class="keyword">const</span> <a class="code" href="classTileMapParams.html">TileMapParams</a>&amp; param,
00766                         <span class="keyword">const</span> <a class="code" href="classTileMapFormatDesc.html">TileMapFormatDesc</a>&amp; mapDesc )
00767 {
00768    this-&gt;first = mapDesc.<a class="code" href="classTileMapFormatDesc.html#a34">getLayerNbrFromID</a>( param.<a class="code" href="classTileMapParams.html#a15">getLayer</a>() );
00769    <span class="keyword">const</span> <a class="code" href="classTileImportanceNotice.html">TileImportanceNotice</a>* notice = 
00770       mapDesc.<a class="code" href="classTileMapFormatDesc.html#a23">getImportanceNbr</a>( param );
00771    this-&gt;second = notice-&gt;<a class="code" href="classTileImportanceNotice.html#a8">getType</a>();
00772    <span class="keywordflow">if</span> ( notice-&gt;<a class="code" href="classTileImportanceNotice.html#a9">getThreshold</a>() &lt; MAX_UINT16 ) {
00773       this-&gt;second |= (notice-&gt;<a class="code" href="classTileImportanceNotice.html#a9">getThreshold</a>() &lt;&lt; 16 );
00774    }
00775 }
00776 
00777 
00778 <span class="keyword">inline</span> <a class="code" href="classTileMap.html">TileMap</a>*
<a name="l00779"></a><a class="code" href="classTileMapContainer.html#a11">00779</a> <a class="code" href="classTileMapContainer.html#a11">TileMapContainer::getMap</a>(<span class="keyword">const</span> <a class="code" href="classMC2SimpleString.html">MC2SimpleString</a>&amp; params)<span class="keyword"> const</span>
00780 <span class="keyword"></span>{  
00781    <span class="keywordflow">return</span> <a class="code" href="classTileMapContainer.html#o0">m_mapsToReq</a>.<a class="code" href="structMapStorage.html#a12">getMap</a>( <a class="code" href="classTileMapContainer.html#o0">m_mapsToReq</a>.<a class="code" href="structMapStorage.html#a6">getMapIndex</a>( params.<a class="code" href="classMC2SimpleString.html#a3">c_str</a>() ) );
00782 }
00783 
00784 
00785 <span class="preprocessor">#endif </span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jun 30 10:11:51 2010 for mc2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
