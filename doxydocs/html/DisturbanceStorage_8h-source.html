<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mc2: DisturbanceStorage.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">Server</a>&nbsp;/&nbsp;<a class="el" href="dir_000010.html">Modules</a>&nbsp;/&nbsp;<a class="el" href="dir_000022.html">RouteModule</a>&nbsp;/&nbsp;<a class="el" href="dir_000023.html">include</a></div>
<h1>DisturbanceStorage.h</h1><a href="DisturbanceStorage_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">Copyright (c) 1999 - 2010, Vodafone Group Services Ltd</span>
00003 <span class="comment">All rights reserved.</span>
00004 <span class="comment"></span>
00005 <span class="comment">Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
00008 <span class="comment">    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
00009 <span class="comment">    * Neither the name of the Vodafone Group Services Ltd nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
00010 <span class="comment"></span>
00011 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00012 <span class="comment">*/</span>
00013 
00014 <span class="preprocessor">#ifndef ROUTINGMAPROLLBACKSTACK</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define ROUTINGMAPROLLBACKSTACK</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#include "<a class="code" href="config_8h.html">config.h</a>"</span>
00018 
00019 <span class="preprocessor">#include &lt;map&gt;</span>
00020 
00021 <span class="keyword">class </span><a class="code" href="classRoutingMap.html">RoutingMap</a>;
00022 <span class="keyword">class </span><a class="code" href="classRoutingNode.html">RoutingNode</a>;
00023 <span class="keyword">class </span><a class="code" href="classRoutingConnection.html">RoutingConnection</a>;
00024 <span class="keyword">class </span><a class="code" href="classRoutingConnectionData.html">RoutingConnectionData</a>;
00025 <span class="keyword">class </span><a class="code" href="classDisturbanceVector.html">DisturbanceVector</a>;
00026 
00027 
00028 <span class="preprocessor">#include "<a class="code" href="RoutingConnection_8h.html">RoutingConnection.h</a>"</span>
<a name="l00034"></a><a class="code" href="classRoutingMapConnChanges.html">00034</a> <span class="keyword">class </span><a class="code" href="classRoutingMapConnChanges.html">RoutingMapConnChanges</a> {
00035 <span class="keyword">public</span>:
<a name="l00044"></a><a class="code" href="classRoutingMapConnChanges.html#a0">00044</a>    <a class="code" href="classRoutingMapConnChanges.html">RoutingMapConnChanges</a>(<a class="code" href="classRoutingNode.html">RoutingNode</a>* fromNode,
00045                          <a class="code" href="classRoutingNode.html">RoutingNode</a>* toNode,
00046                          <span class="keyword">const</span> <a class="code" href="classRoutingConnectionData.html">RoutingConnectionData</a>&amp; oldConnData,
00047                          <span class="keyword">const</span> <a class="code" href="classRoutingConnectionData.html">RoutingConnectionData</a>&amp; newConnData,
00048                          <span class="keywordtype">bool</span> forward)
00049          : m_fromNode(fromNode),
00050            m_toNode(toNode),
00051            m_origData(oldConnData),
00052            m_newData(newConnData),
00053            m_forward(forward)
00054       {
00055       }
00056 
00061    <span class="keywordtype">void</span> rollBack(<span class="keyword">const</span> <a class="code" href="classRoutingMap.html">RoutingMap</a>* theMap);
00062    
00070    <span class="keywordtype">bool</span> applyDiff(<span class="keyword">const</span> <a class="code" href="classRoutingMap.html">RoutingMap</a>* theMap,
00071                   <a class="code" href="classRoutingNode.html">RoutingNode</a>* node,
00072                   <a class="code" href="classRoutingConnection.html">RoutingConnection</a>* conn,
00073                   <a class="code" href="classfromToNode__t.html">fromToNode_t</a>* causingConn = NULL) <span class="keyword">const</span>;
00074 
00082    <span class="keywordtype">bool</span> applyDiff(<span class="keyword">const</span> <a class="code" href="classRoutingMap.html">RoutingMap</a>* theMap,
00083                   <a class="code" href="classRoutingNode.html">RoutingNode</a>* fromNode,
00084                   <a class="code" href="classRoutingNode.html">RoutingNode</a>* toNode,
00085                   <a class="code" href="classfromToNode__t.html">fromToNode_t</a>* causingConn = NULL) <span class="keyword">const</span>;
00086 
<a name="l00090"></a><a class="code" href="classRoutingMapConnChanges.html#a4">00090</a>    <a class="code" href="Types_8h.html#a21">uint32</a> getFromNodeID()<span class="keyword"> const </span>{
00091       <span class="keywordflow">return</span> m_fromNode-&gt;getItemID();
00092    }
00093    
<a name="l00097"></a><a class="code" href="classRoutingMapConnChanges.html#a5">00097</a>    <a class="code" href="Types_8h.html#a21">uint32</a> getToNodeID()<span class="keyword"> const </span>{
00098       <span class="keywordflow">return</span> m_toNode-&gt;getItemID();
00099    }
00100 
<a name="l00104"></a><a class="code" href="classRoutingMapConnChanges.html#a6">00104</a>    <span class="keyword">const</span> <a class="code" href="classRoutingConnectionData.html">RoutingConnectionData</a>&amp; getOldData()<span class="keyword"> const </span>{
00105       <span class="keywordflow">return</span> m_origData;
00106    }
00107 <span class="keyword">private</span>:
<a name="l00109"></a><a class="code" href="classRoutingMapConnChanges.html#r0">00109</a>    <a class="code" href="classRoutingNode.html">RoutingNode</a>* m_fromNode;
<a name="l00111"></a><a class="code" href="classRoutingMapConnChanges.html#r1">00111</a>    <a class="code" href="classRoutingNode.html">RoutingNode</a>* m_toNode;
<a name="l00113"></a><a class="code" href="classRoutingMapConnChanges.html#r2">00113</a>    <a class="code" href="classRoutingConnectionData.html">RoutingConnectionData</a> m_origData;
<a name="l00115"></a><a class="code" href="classRoutingMapConnChanges.html#r3">00115</a>    <a class="code" href="classRoutingConnectionData.html">RoutingConnectionData</a> m_newData;
<a name="l00117"></a><a class="code" href="classRoutingMapConnChanges.html#r4">00117</a>    <span class="keywordtype">bool</span> m_forward;
00118 };
00119 
00120 
00121 
00122 
00123 
00124 <span class="comment">//---------------------------------------------------------------------</span>
00125 <span class="comment">// Stack begins here.</span>
00126 <span class="comment">//---------------------------------------------------------------------</span>
00127 
<a name="l00132"></a><a class="code" href="classDisturbanceStorage.html">00132</a> <span class="keyword">class </span><a class="code" href="classDisturbanceStorage.html">DisturbanceStorage</a> {
00133    
00134 <span class="keyword">public</span>:
00135 
00140    <a class="code" href="classDisturbanceStorage.html">DisturbanceStorage</a>(<a class="code" href="classRoutingMap.html">RoutingMap</a>* routingMap);
00141    
<a name="l00145"></a><a class="code" href="classDisturbanceStorage.html#a1">00145</a>    <span class="keyword">virtual</span> ~<a class="code" href="classDisturbanceStorage.html">DisturbanceStorage</a>() {}
00146    
00151    <span class="keywordtype">void</span> addConnectionChange(<a class="code" href="classRoutingNode.html">RoutingNode</a>* fromNode,
00152                             <a class="code" href="classRoutingNode.html">RoutingNode</a>* toNode,                    
00153                             <span class="keyword">const</span> <a class="code" href="classRoutingConnectionData.html">RoutingConnectionData</a>&amp; newData,
00154                             <span class="keywordtype">bool</span> forward);
00155 
00160    <span class="keywordtype">void</span> avoidNode(<a class="code" href="classRoutingNode.html">RoutingNode</a>* node);
00161 
00166    <span class="keywordtype">int</span> rollBackAll();
00167 
00176    <span class="keywordtype">int</span> rollBackOne(uint32 fromNodeID, uint32 toNodeID);
00177 
00183    <span class="keyword">inline</span> <span class="keywordtype">bool</span> getOldCosts(uint32 fromNodeID,
00184                            uint32 toNodeID,
00185                            uint32&amp; costA,
00186                            uint32&amp; costB,
00187                            uint32&amp; costC,
00188                            uint32&amp; costD);
00189 
00194    <span class="keywordtype">void</span> changeConnectionCosts( <a class="code" href="classRoutingNode.html">RoutingNode</a>* node,
00195                                <a class="code" href="classRoutingConnection.html">RoutingConnection</a>* conn,
00196                                uint32 costA,
00197                                uint32 costB,
00198                                uint32 costC,
00199                                uint32 vehicleRestrictions);
00203    <span class="keywordtype">int</span> addDisturbances( <span class="keyword">const</span> <a class="code" href="classDisturbanceVector.html">DisturbanceVector</a>* distVect );
00204    
00205 <span class="keyword">protected</span>:
00206 
00213    <span class="keywordtype">int</span> updateMulti(<a class="code" href="classRoutingMapConnChanges.html">RoutingMapConnChanges</a>* change,
00214                    <span class="keywordtype">bool</span> removing);
00215 
00223    <span class="keywordtype">bool</span> removeNodeFromMultiConnection(<span class="keyword">const</span> <a class="code" href="classfromToNode__t.html">fromToNode_t</a>&amp; multi,
00224                                       <span class="keyword">const</span> <a class="code" href="classfromToNode__t.html">fromToNode_t</a>&amp; notmulti);
00225 
00232    <span class="keywordtype">int</span> applyAllConnectionChangesToMultiConnection(<span class="keyword">const</span> <a class="code" href="classfromToNode__t.html">fromToNode_t</a>&amp; multi);
00233    
00234 
<a name="l00238"></a><a class="code" href="classDisturbanceStorage.html#x0">00238</a>    <span class="keyword">typedef</span> <a class="code" href="classmap.html">map&lt;fromToNode_t, RoutingMapConnChanges &gt;</a> <a class="code" href="classmap.html">changedNodes_t</a>;
00239    
<a name="l00246"></a><a class="code" href="classDisturbanceStorage.html#p0">00246</a>    changedNodes_t m_changedNodes;
00247 
<a name="l00251"></a><a class="code" href="classDisturbanceStorage.html#p1">00251</a>    <a class="code" href="classRoutingMap.html">RoutingMap</a>* m_map;
00252 
<a name="l00256"></a><a class="code" href="classDisturbanceStorage.html#x1">00256</a>    <span class="keyword">typedef</span> multimap&lt;fromToNode_t, fromToNode_t&gt; nodesInMultiMap_t;
00257 
<a name="l00263"></a><a class="code" href="classDisturbanceStorage.html#p2">00263</a>    nodesInMultiMap_t m_nodesInMulti;
00264 };
00265 
00266 <span class="preprocessor">#include "<a class="code" href="RoutingNode_8h.html">RoutingNode.h</a>"</span>
00267 <span class="preprocessor">#include "<a class="code" href="RoutingConnection_8h.html">RoutingConnection.h</a>"</span>
00268 
00269 
00270 <span class="keyword">inline</span> <span class="keywordtype">bool</span>
<a name="l00271"></a><a class="code" href="classDisturbanceStorage.html#a6">00271</a> <a class="code" href="classDisturbanceStorage.html#a6">DisturbanceStorage::getOldCosts</a>(uint32 fromNodeID,
00272                                 uint32 toNodeID,
00273                                 uint32&amp; costA,
00274                                 uint32&amp; costB,
00275                                 uint32&amp; costC,
00276                                 uint32&amp; costD)
00277 {
00278    <span class="keywordflow">if</span> ( <a class="code" href="config_8h.html#a22">MC2_LIKELY</a>(<a class="code" href="classDisturbanceStorage.html#p0">m_changedNodes</a>.empty()) )
00279       <span class="keywordflow">return</span> <span class="keyword">false</span>;
00280    
00281    changedNodes_t::const_iterator it =
00282       <a class="code" href="classDisturbanceStorage.html#p0">m_changedNodes</a>.find(<a class="code" href="classfromToNode__t.html">fromToNode_t</a>(fromNodeID, toNodeID));
00283    
00284    <span class="keywordflow">if</span> ( <a class="code" href="config_8h.html#a22">MC2_LIKELY</a>(it == <a class="code" href="classDisturbanceStorage.html#p0">m_changedNodes</a>.end()) )
00285       <span class="keywordflow">return</span> <span class="keyword">false</span>;
00286 
00287    costA = it-&gt;second.getOldData().getCostA(0);
00288    costB = it-&gt;second.getOldData().getCostB(0);
00289    costC = it-&gt;second.getOldData().getCostC(0);
00290    costD = it-&gt;second.getOldData().getCostD();
00291    
00292    <span class="keywordflow">return</span> <span class="keyword">true</span>;
00293 }
00294 
00295 
00296 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jun 30 10:11:46 2010 for mc2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
