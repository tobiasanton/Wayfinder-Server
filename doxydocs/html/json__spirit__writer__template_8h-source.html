<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mc2: json_spirit_writer_template.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">Server</a>&nbsp;/&nbsp;<a class="el" href="dir_000005.html">Shared</a>&nbsp;/&nbsp;<a class="el" href="dir_000053.html">JSON</a>&nbsp;/&nbsp;<a class="el" href="dir_000054.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000055.html">json_spirit</a></div>
<h1>json_spirit_writer_template.h</h1><a href="json__spirit__writer__template_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef JSON_SPIRIT_WRITER_TEMPLATE</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define JSON_SPIRIT_WRITER_TEMPLATE</span>
00003 <span class="preprocessor"></span>
00004 <span class="comment">//          Copyright John W. Wilkinson 2007 - 2009.</span>
00005 <span class="comment">// Distributed under the MIT License, see accompanying file LICENSE.txt</span>
00006 
00007 <span class="comment">// json spirit version 4.03</span>
00008 
00009 <span class="preprocessor">#include "<a class="code" href="json__spirit__value_8h.html">json_spirit/json_spirit_value.h</a>"</span>
00010 
00011 <span class="preprocessor">#include &lt;cassert&gt;</span>
00012 <span class="preprocessor">#include &lt;sstream&gt;</span>
00013 <span class="preprocessor">#include &lt;iomanip&gt;</span>
00014 
00015 <span class="keyword">namespace </span>json_spirit
00016 {
<a name="l00017"></a><a class="code" href="namespacejson__spirit.html#a52">00017</a>     <span class="keyword">inline</span> <span class="keywordtype">char</span> <a class="code" href="namespacejson__spirit.html#a52">to_hex_char</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c )
00018     {
00019         assert( c &lt;= 0xF );
00020 
00021         <span class="keyword">const</span> <span class="keywordtype">char</span> ch = static_cast&lt; char &gt;( c );
00022 
00023         <span class="keywordflow">if</span>( ch &lt; 10 ) <span class="keywordflow">return</span> <span class="charliteral">'0'</span> + ch;
00024 
00025         <span class="keywordflow">return</span> <span class="charliteral">'A'</span> - 10 + ch;
00026     }
00027 
00028     <span class="keyword">template</span>&lt; <span class="keyword">class</span> String_type &gt;
<a name="l00029"></a><a class="code" href="namespacejson__spirit.html#a53">00029</a>     String_type <a class="code" href="namespacejson__spirit.html#a53">non_printable_to_string</a>( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c )
00030     {
00031         <span class="keyword">typedef</span> <span class="keyword">typename</span> String_type::value_type Char_type;
00032 
00033         String_type result( 6, <span class="charliteral">'\\'</span> );
00034 
00035         result[1] = <span class="charliteral">'u'</span>;
00036 
00037         result[ 5 ] = <a class="code" href="namespacejson__spirit.html#a52">to_hex_char</a>( c &amp; 0x000F ); c &gt;&gt;= 4;
00038         result[ 4 ] = <a class="code" href="namespacejson__spirit.html#a52">to_hex_char</a>( c &amp; 0x000F ); c &gt;&gt;= 4;
00039         result[ 3 ] = <a class="code" href="namespacejson__spirit.html#a52">to_hex_char</a>( c &amp; 0x000F ); c &gt;&gt;= 4;
00040         result[ 2 ] = <a class="code" href="namespacejson__spirit.html#a52">to_hex_char</a>( c &amp; 0x000F );
00041 
00042         <span class="keywordflow">return</span> result;
00043     }
00044 
00045     <span class="keyword">template</span>&lt; <span class="keyword">typename</span> Char_type, <span class="keyword">class</span> String_type &gt;
<a name="l00046"></a><a class="code" href="namespacejson__spirit.html#a54">00046</a>     <span class="keywordtype">bool</span> <a class="code" href="namespacejson__spirit.html#a54">add_esc_char</a>( Char_type c, String_type&amp; s )
00047     {
00048         <span class="keywordflow">switch</span>( c )
00049         {
00050             <span class="keywordflow">case</span> <span class="charliteral">'"'</span>:  s += to_str&lt; String_type &gt;( <span class="stringliteral">"\\\""</span> ); <span class="keywordflow">return</span> <span class="keyword">true</span>;
00051             <span class="keywordflow">case</span> <span class="charliteral">'\\'</span>: s += to_str&lt; String_type &gt;( <span class="stringliteral">"\\\\"</span> ); <span class="keywordflow">return</span> <span class="keyword">true</span>;
00052             <span class="keywordflow">case</span> <span class="charliteral">'\b'</span>: s += to_str&lt; String_type &gt;( <span class="stringliteral">"\\b"</span>  ); <span class="keywordflow">return</span> <span class="keyword">true</span>;
00053             <span class="keywordflow">case</span> <span class="charliteral">'\f'</span>: s += to_str&lt; String_type &gt;( <span class="stringliteral">"\\f"</span>  ); <span class="keywordflow">return</span> <span class="keyword">true</span>;
00054             <span class="keywordflow">case</span> <span class="charliteral">'\n'</span>: s += to_str&lt; String_type &gt;( <span class="stringliteral">"\\n"</span>  ); <span class="keywordflow">return</span> <span class="keyword">true</span>;
00055             <span class="keywordflow">case</span> <span class="charliteral">'\r'</span>: s += to_str&lt; String_type &gt;( <span class="stringliteral">"\\r"</span>  ); <span class="keywordflow">return</span> <span class="keyword">true</span>;
00056             <span class="keywordflow">case</span> <span class="charliteral">'\t'</span>: s += to_str&lt; String_type &gt;( <span class="stringliteral">"\\t"</span>  ); <span class="keywordflow">return</span> <span class="keyword">true</span>;
00057         }
00058 
00059         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00060     }
00061 
00062     <span class="keyword">template</span>&lt; <span class="keyword">class</span> String_type &gt;
<a name="l00063"></a><a class="code" href="namespacejson__spirit.html#a55">00063</a>     String_type <a class="code" href="namespacejson__spirit.html#a55">add_esc_chars</a>( <span class="keyword">const</span> String_type&amp; s )
00064     {
00065         <span class="keyword">typedef</span> <span class="keyword">typename</span> String_type::const_iterator Iter_type;
00066         <span class="keyword">typedef</span> <span class="keyword">typename</span> String_type::value_type     Char_type;
00067 
00068         String_type result;
00069 
00070         <span class="keyword">const</span> Iter_type end( s.end() );
00071 
00072         <span class="keywordflow">for</span>( Iter_type i = s.begin(); i != end; ++i )
00073         {
00074             <span class="keyword">const</span> Char_type c( *i );
00075 
00076             <span class="keywordflow">if</span>( <a class="code" href="namespacejson__spirit.html#a54">add_esc_char</a>( c, result ) ) <span class="keywordflow">continue</span>;
00077 
00078             <span class="keyword">const</span> wint_t unsigned_c( ( c &gt;= 0 ) ? c : 256 + c );
00079 
00080             <span class="keywordflow">if</span>( iswprint( unsigned_c ) )
00081             {
00082                 result += c;
00083             }
00084             <span class="keywordflow">else</span>
00085             {
00086                 result += non_printable_to_string&lt; String_type &gt;( unsigned_c );
00087             }
00088         }
00089 
00090         <span class="keywordflow">return</span> result;
00091     }
00092 
00093     <span class="comment">// this class generates the JSON text,</span>
00094     <span class="comment">// it keeps track of the indentation level etc.</span>
00095     <span class="comment">//</span>
00096     <span class="keyword">template</span>&lt; <span class="keyword">class</span> Value_type, <span class="keyword">class</span> Ostream_type &gt;
<a name="l00097"></a><a class="code" href="classjson__spirit_1_1Generator.html">00097</a>     <span class="keyword">class </span><a class="code" href="classjson__spirit_1_1Generator.html">Generator</a>
00098     {
<a name="l00099"></a><a class="code" href="classjson__spirit_1_1Generator.html#y0">00099</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> Value_type::Config_type Config_type;
<a name="l00100"></a><a class="code" href="classjson__spirit_1_1Generator.html#y1">00100</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> Config_type::String_type String_type;
<a name="l00101"></a><a class="code" href="classjson__spirit_1_1Generator.html#y2">00101</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> Config_type::Object_type Object_type;
<a name="l00102"></a><a class="code" href="classjson__spirit_1_1Generator.html#y3">00102</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> Config_type::Array_type Array_type;
<a name="l00103"></a><a class="code" href="classjson__spirit_1_1Generator.html#y4">00103</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> String_type::value_type Char_type;
<a name="l00104"></a><a class="code" href="classjson__spirit_1_1Generator.html#y5">00104</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> Object_type::value_type Obj_member_type;
00105 
00106     <span class="keyword">public</span>:
00107 
<a name="l00108"></a><a class="code" href="classjson__spirit_1_1Generator.html#a0">00108</a>         <a class="code" href="classjson__spirit_1_1Generator.html">Generator</a>( <span class="keyword">const</span> Value_type&amp; value, Ostream_type&amp; os, <span class="keywordtype">bool</span> pretty )
00109         :   os_( os )
00110         ,   indentation_level_( 0 )
00111         ,   pretty_( pretty )
00112         {
00113             output( value );
00114         }
00115 
00116     <span class="keyword">private</span>:
00117 
<a name="l00118"></a><a class="code" href="classjson__spirit_1_1Generator.html#d0">00118</a>         <span class="keywordtype">void</span> output( <span class="keyword">const</span> Value_type&amp; value )
00119         {
00120             <span class="keywordflow">switch</span>( value.type() )
00121             {
00122                 <span class="keywordflow">case</span> <a class="code" href="namespacejson__spirit.html#a58a22">obj_type</a>:   output( value.get_obj() );   <span class="keywordflow">break</span>;
00123                 <span class="keywordflow">case</span> <a class="code" href="namespacejson__spirit.html#a58a23">array_type</a>: output( value.get_array() ); <span class="keywordflow">break</span>;
00124                 <span class="keywordflow">case</span> <a class="code" href="namespacejson__spirit.html#a58a24">str_type</a>:   output( value.get_str() );   <span class="keywordflow">break</span>;
00125                 <span class="keywordflow">case</span> <a class="code" href="namespacejson__spirit.html#a58a25">bool_type</a>:  output( value.get_bool() );  <span class="keywordflow">break</span>;
00126                 <span class="keywordflow">case</span> <a class="code" href="namespacejson__spirit.html#a58a26">int_type</a>:   output_int( value );         <span class="keywordflow">break</span>;
00127                 <span class="keywordflow">case</span> <a class="code" href="namespacejson__spirit.html#a58a27">real_type</a>:  os_ &lt;&lt; std::showpoint &lt;&lt; std::setprecision( 16 ) 
00128                                      &lt;&lt; value.get_real();     <span class="keywordflow">break</span>;
00129                 <span class="keywordflow">case</span> <a class="code" href="namespacejson__spirit.html#a58a28">null_type</a>:  os_ &lt;&lt; <span class="stringliteral">"null"</span>;               <span class="keywordflow">break</span>;
00130                 <span class="keywordflow">default</span>: assert( <span class="keyword">false</span> );
00131             }
00132         }
00133 
<a name="l00134"></a><a class="code" href="classjson__spirit_1_1Generator.html#d1">00134</a>         <span class="keywordtype">void</span> output( <span class="keyword">const</span> Object_type&amp; obj )
00135         {
00136             output_array_or_obj( obj, <span class="charliteral">'{'</span>, <span class="charliteral">'}'</span> );
00137         }
00138 
<a name="l00139"></a><a class="code" href="classjson__spirit_1_1Generator.html#d2">00139</a>         <span class="keywordtype">void</span> output( <span class="keyword">const</span> Array_type&amp; arr )
00140         {
00141             output_array_or_obj( arr, <span class="charliteral">'['</span>, <span class="charliteral">']'</span> );
00142         }
00143 
<a name="l00144"></a><a class="code" href="classjson__spirit_1_1Generator.html#d3">00144</a>         <span class="keywordtype">void</span> output( <span class="keyword">const</span> Obj_member_type&amp; member )
00145         {
00146             output( Config_type::get_name( member ) ); space(); 
00147             os_ &lt;&lt; <span class="charliteral">':'</span>; space(); 
00148             output( Config_type::get_value( member ) );
00149         }
00150 
<a name="l00151"></a><a class="code" href="classjson__spirit_1_1Generator.html#d4">00151</a>         <span class="keywordtype">void</span> output_int( <span class="keyword">const</span> Value_type&amp; value )
00152         {
00153             <span class="keywordflow">if</span>( value.is_uint64() )
00154             {
00155                 os_ &lt;&lt; value.get_uint64();
00156             }
00157             <span class="keywordflow">else</span>
00158             {
00159                os_ &lt;&lt; value.get_int64();
00160             }
00161         }
00162 
<a name="l00163"></a><a class="code" href="classjson__spirit_1_1Generator.html#d5">00163</a>         <span class="keywordtype">void</span> output( <span class="keyword">const</span> String_type&amp; s )
00164         {
00165             os_ &lt;&lt; <span class="charliteral">'"'</span> &lt;&lt; <a class="code" href="namespacejson__spirit.html#a55">add_esc_chars</a>( s ) &lt;&lt; <span class="charliteral">'"'</span>;
00166         }
00167 
<a name="l00168"></a><a class="code" href="classjson__spirit_1_1Generator.html#d6">00168</a>         <span class="keywordtype">void</span> output( <span class="keywordtype">bool</span> b )
00169         {
00170             os_ &lt;&lt; to_str&lt; String_type &gt;( b ? <span class="stringliteral">"true"</span> : <span class="stringliteral">"false"</span> );
00171         }
00172 
00173         <span class="keyword">template</span>&lt; <span class="keyword">class</span> T &gt;
<a name="l00174"></a><a class="code" href="classjson__spirit_1_1Generator.html#d7">00174</a>         <span class="keywordtype">void</span> output_array_or_obj( <span class="keyword">const</span> T&amp; t, Char_type start_char, Char_type end_char )
00175         {
00176             os_ &lt;&lt; start_char; new_line();
00177 
00178             ++indentation_level_;
00179             
00180             <span class="keywordflow">for</span>( <span class="keyword">typename</span> T::const_iterator i = t.begin(); i != t.end(); ++i )
00181             {
00182                 indent(); output( *i );
00183 
00184                 <span class="keyword">typename</span> T::const_iterator next = i;
00185 
00186                 <span class="keywordflow">if</span>( ++next != t.end())
00187                 {
00188                     os_ &lt;&lt; <span class="charliteral">','</span>;
00189                 }
00190 
00191                 new_line();
00192             }
00193 
00194             --indentation_level_;
00195 
00196             indent(); os_ &lt;&lt; end_char;
00197         }
00198         
<a name="l00199"></a><a class="code" href="classjson__spirit_1_1Generator.html#d8">00199</a>         <span class="keywordtype">void</span> indent()
00200         {
00201             <span class="keywordflow">if</span>( !pretty_ ) <span class="keywordflow">return</span>;
00202 
00203             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; indentation_level_; ++i )
00204             { 
00205                 os_ &lt;&lt; <span class="stringliteral">"    "</span>;
00206             }
00207         }
00208 
<a name="l00209"></a><a class="code" href="classjson__spirit_1_1Generator.html#d9">00209</a>         <span class="keywordtype">void</span> space()
00210         {
00211             <span class="keywordflow">if</span>( pretty_ ) os_ &lt;&lt; <span class="charliteral">' '</span>;
00212         }
00213 
<a name="l00214"></a><a class="code" href="classjson__spirit_1_1Generator.html#d10">00214</a>         <span class="keywordtype">void</span> new_line()
00215         {
00216             <span class="keywordflow">if</span>( pretty_ ) os_ &lt;&lt; <span class="charliteral">'\n'</span>;
00217         }
00218 
00219         <a class="code" href="classjson__spirit_1_1Generator.html">Generator</a>&amp; operator=( <span class="keyword">const</span> <a class="code" href="classjson__spirit_1_1Generator.html">Generator</a>&amp; ); <span class="comment">// to prevent "assignment operator could not be generated" warning</span>
00220 
<a name="l00221"></a><a class="code" href="classjson__spirit_1_1Generator.html#r0">00221</a>         Ostream_type&amp; os_;
<a name="l00222"></a><a class="code" href="classjson__spirit_1_1Generator.html#r1">00222</a>         <span class="keywordtype">int</span> indentation_level_;
<a name="l00223"></a><a class="code" href="classjson__spirit_1_1Generator.html#r2">00223</a>         <span class="keywordtype">bool</span> pretty_;
00224     };
00225 
00226     <span class="keyword">template</span>&lt; <span class="keyword">class</span> Value_type, <span class="keyword">class</span> Ostream_type &gt;
<a name="l00227"></a><a class="code" href="namespacejson__spirit.html#a56">00227</a>     <span class="keywordtype">void</span> <a class="code" href="namespacejson__spirit.html#a56">write_stream</a>( <span class="keyword">const</span> Value_type&amp; value, Ostream_type&amp; os, <span class="keywordtype">bool</span> pretty )
00228     {
00229         <a class="code" href="classjson__spirit_1_1Generator.html">Generator&lt; Value_type, Ostream_type &gt;</a>( value, os, pretty );
00230     }
00231 
00232     <span class="keyword">template</span>&lt; <span class="keyword">class</span> Value_type &gt;
<a name="l00233"></a><a class="code" href="namespacejson__spirit.html#a57">00233</a>     <span class="keyword">typename</span> Value_type::String_type <a class="code" href="namespacejson__spirit.html#a57">write_string</a>( <span class="keyword">const</span> Value_type&amp; value, <span class="keywordtype">bool</span> pretty )
00234     {
00235         <span class="keyword">typedef</span> <span class="keyword">typename</span> Value_type::String_type::value_type Char_type;
00236 
00237         std::basic_ostringstream&lt; Char_type &gt; os;
00238 
00239         <a class="code" href="namespacejson__spirit.html#a56">write_stream</a>( value, os, pretty );
00240 
00241         <span class="keywordflow">return</span> os.str();
00242     }
00243 }
00244 
00245 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jun 30 10:11:47 2010 for mc2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
