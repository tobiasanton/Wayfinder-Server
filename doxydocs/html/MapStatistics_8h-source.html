<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mc2: MapStatistics.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000002.html">Server</a>&nbsp;/&nbsp;<a class="el" href="dir_000010.html">Modules</a>&nbsp;/&nbsp;<a class="el" href="dir_000021.html">include</a></div>
<h1>MapStatistics.h</h1><a href="MapStatistics_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">Copyright (c) 1999 - 2010, Vodafone Group Services Ltd</span>
00003 <span class="comment">All rights reserved.</span>
00004 <span class="comment"></span>
00005 <span class="comment">Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
00008 <span class="comment">    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
00009 <span class="comment">    * Neither the name of the Vodafone Group Services Ltd nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
00010 <span class="comment"></span>
00011 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00012 <span class="comment">*/</span>
00013 
00014 <span class="preprocessor">#ifndef MAP_STATUISTITSCS_H</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define MAP_STATUISTITSCS_H</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#include "<a class="code" href="config_8h.html">config.h</a>"</span>
00018 <span class="preprocessor">#include &lt;set&gt;</span>
00019 <span class="preprocessor">#include &lt;map&gt;</span>
00020 <span class="preprocessor">#include &lt;iostream&gt;</span>
00021 <span class="preprocessor">#include "<a class="code" href="MC2String_8h.html">MC2String.h</a>"</span>
00022 
00023 <span class="keyword">class </span><a class="code" href="classPacket.html">Packet</a>;
00024 
<a name="l00029"></a><a class="code" href="classMapElement.html">00029</a> <span class="keyword">class </span><a class="code" href="classMapElement.html">MapElement</a> {
00030 <span class="keyword">public</span>:
00036    <a class="code" href="classMapElement.html">MapElement</a>(<a class="code" href="Types_8h.html#a21">uint32</a> mapID, <a class="code" href="Types_8h.html#a21">uint32</a> size);
00037    
<a name="l00041"></a><a class="code" href="classMapElement.html#a1">00041</a>    <span class="keyword">virtual</span> ~<a class="code" href="classMapElement.html">MapElement</a>(){};
00042 
<a name="l00047"></a><a class="code" href="classMapElement.html#a2">00047</a>    <a class="code" href="Types_8h.html#a21">uint32</a> getMapSize()<span class="keyword"> const</span>
00048 <span class="keyword">      </span>{ <span class="keywordflow">return</span> m_size;}
00049    
00050 
<a name="l00055"></a><a class="code" href="classMapElement.html#a3">00055</a>    <a class="code" href="Types_8h.html#a21">uint32</a> getMapID()<span class="keyword"> const</span>
00056 <span class="keyword">      </span>{ <span class="keywordflow">return</span> m_mapID;}
00057 
00058 
<a name="l00063"></a><a class="code" href="classMapElement.html#a4">00063</a>    <span class="keywordtype">void</span> setMapID(uint32 mapID)
00064       { m_mapID = mapID;}
00065    
00066 
<a name="l00071"></a><a class="code" href="classMapElement.html#a5">00071</a>    <span class="keywordtype">void</span> setSize(uint32 size)
00072       { m_size = size;}
00073 
<a name="l00077"></a><a class="code" href="classMapElement.html#a6">00077</a>    <a class="code" href="Types_8h.html#a21">uint32</a> getSize()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_size; }
00078 
00082    <span class="keywordtype">bool</span> isMapLoadedOrLoading() <span class="keyword">const</span>;
00083 
00087    <span class="keywordtype">bool</span> isMapLoaded() <span class="keyword">const</span>;
00088 
00092    <span class="keywordtype">void</span> updateLastUse();
00093 
<a name="l00097"></a><a class="code" href="classMapElement.html#a10">00097</a>    <a class="code" href="Types_8h.html#a21">uint32</a> getLastUse()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_lastUse; }
00098    
<a name="l00099"></a><a class="code" href="classMapElement.html#w6">00099</a>    <span class="keyword">enum</span> status_t {
00101       TOLD_TO_LOAD   = 0,
00103       LOADING        = 1,
00105       LOADED         = 2,
00107       TOLD_TO_DELETE = 3,
00109       DELETING       = 4,
00111       DELETED        = 5
00112    };
00113 
<a name="l00117"></a><a class="code" href="classMapElement.html#a11">00117</a>    <span class="keywordtype">bool</span> isLoading()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_status == TOLD_TO_LOAD ||
00118                                    m_status == LOADING; }
00119 
<a name="l00123"></a><a class="code" href="classMapElement.html#a12">00123</a>    <span class="keywordtype">bool</span> isDeleting()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_status == TOLD_TO_DELETE ||
00124                                     m_status == DELETING; }
00125 
00126    
00127 
<a name="l00131"></a><a class="code" href="classMapElement.html#a13">00131</a>    status_t getStatus()<span class="keyword"> const </span>{
00132       <span class="keywordflow">return</span> m_status;
00133    }
00134 
<a name="l00138"></a><a class="code" href="classMapElement.html#a14">00138</a>    <span class="keywordtype">void</span> setStatus(status_t newStatus) {
00139       m_status = newStatus;
00140    }
00141 
00145    <span class="keyword">const</span> <span class="keywordtype">char</span>* getStatusAsString() <span class="keyword">const</span>;
00146 
<a name="l00152"></a><a class="code" href="classMapElement.html#a16">00152</a>    <span class="keywordtype">bool</span> <a class="code" href="namespaceSTLUtility.html#a32">operator&lt;</a>(<span class="keyword">const</span> <a class="code" href="classMapElement.html">MapElement</a>&amp; other)<span class="keyword"> const </span>{
00153       <span class="keywordflow">return</span> m_mapID &lt; other.<a class="code" href="classMapElement.html#r0">m_mapID</a>;
00154    }
00155    
00161    <span class="keywordtype">int</span> <a class="code" href="namespaceTileFeatureScaleRange.html#a3">save</a>(<a class="code" href="classPacket.html">Packet</a>* p, <span class="keywordtype">int</span>&amp; pos ) <span class="keyword">const</span>;
00162 
00168    <span class="keywordtype">int</span> <a class="code" href="namespaceTileFeatureScaleRange.html#a4">load</a>(<span class="keyword">const</span> <a class="code" href="classPacket.html">Packet</a>* p, <span class="keywordtype">int</span>&amp; pos );
00169 
00170 <span class="keyword">private</span>:
00171          
<a name="l00173"></a><a class="code" href="classMapElement.html#r0">00173</a>    <a class="code" href="Types_8h.html#a21">uint32</a> m_mapID;
00174 
<a name="l00176"></a><a class="code" href="classMapElement.html#r1">00176</a>    <a class="code" href="Types_8h.html#a21">uint32</a> m_size;
00177 
<a name="l00179"></a><a class="code" href="classMapElement.html#r2">00179</a>    <a class="code" href="Types_8h.html#a21">uint32</a> m_lastUse;
00180    
<a name="l00182"></a><a class="code" href="classMapElement.html#r3">00182</a>    status_t m_status;
00183    
00184 };
00185 
<a name="l00191"></a><a class="code" href="classMapStatistics.html">00191</a> <span class="keyword">class </span><a class="code" href="classMapStatistics.html">MapStatistics</a> : <span class="keyword">protected</span> <a class="code" href="classmap.html">map</a>&lt;uint32, MapElement&gt; {
00192 <span class="keyword">public</span>:
00193    
00197    <a class="code" href="classMapStatistics.html#a0">MapStatistics</a>();
00198    
00202    <span class="keyword">virtual</span> <a class="code" href="classMapStatistics.html#a1">~MapStatistics</a>();
00203    
00207    <span class="keywordtype">int</span> <a class="code" href="classMapStatistics.html#a2">save</a>(<a class="code" href="classPacket.html">Packet</a>* p, <span class="keywordtype">int</span>&amp; pos) <span class="keyword">const</span>;
00208    
00212    <span class="keywordtype">int</span> <a class="code" href="classMapStatistics.html#a3">load</a>(<span class="keyword">const</span> <a class="code" href="classPacket.html">Packet</a>* p, <span class="keywordtype">int</span>&amp; pos);
00213    
00217    <span class="keywordtype">void</span> <a class="code" href="classMapStatistics.html#a4">setMaxMem</a>(<a class="code" href="Types_8h.html#a23">uint64</a> maxMem);
00218    
<a name="l00222"></a><a class="code" href="classMapStatistics.html#a5">00222</a>    <a class="code" href="Types_8h.html#a23">uint64</a> <a class="code" href="classMapStatistics.html#a5">getMaxMem</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_maxMem; }
00223    
00227    <span class="keywordtype">void</span> <a class="code" href="classMapStatistics.html#a6">setOptMem</a>(uint64 optMem);
00228    
<a name="l00232"></a><a class="code" href="classMapStatistics.html#a7">00232</a>    <a class="code" href="Types_8h.html#a23">uint64</a> <a class="code" href="classMapStatistics.html#a7">getOptMem</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_optMem; }
00233    
<a name="l00237"></a><a class="code" href="classMapStatistics.html#a8">00237</a>    <span class="keywordtype">int</span> <a class="code" href="classMapStatistics.html#a8">getQueueLength</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_queueLength; }
00238    
00242    <a class="code" href="Types_8h.html#a23">uint64</a> <a class="code" href="classMapStatistics.html#a9">calcUsedMem</a>() <span class="keyword">const</span>;
00243 
00247    <span class="keywordtype">bool</span> <a class="code" href="classMapStatistics.html#a10">moduleIsLoading</a>() <span class="keyword">const</span>;
00248 
00252    <span class="keywordtype">bool</span> <a class="code" href="classMapStatistics.html#a11">moduleIsDeleting</a>() <span class="keyword">const</span>;
00253 
<a name="l00258"></a><a class="code" href="classMapStatistics.html#a12">00258</a>    <a class="code" href="Types_8h.html#a21">uint32</a> <a class="code" href="classMapStatistics.html#a12">getNbrOfMaps</a>() {
00259       <span class="keywordflow">return</span> size();
00260    }
00261    
00267    <span class="keywordtype">bool</span> <a class="code" href="classMapStatistics.html#a13">isMapLoadedOrLoading</a>(uint32 mapID) <span class="keyword">const</span>;
00268 
00272    <span class="keywordtype">bool</span> <a class="code" href="classMapStatistics.html#a14">isMapLoading</a>( uint32 mapID ) <span class="keyword">const</span>;
00273    
00277    <span class="keywordtype">bool</span> <a class="code" href="classMapStatistics.html#a15">isMapLoaded</a>(uint32 mapID) <span class="keyword">const</span>;
00278 
00284    <span class="keywordtype">bool</span> <a class="code" href="classMapStatistics.html#a16">finishLoadingMap</a>(uint32 mapID, uint32 mapSize);
00285 
00289    <span class="keywordtype">bool</span> <a class="code" href="classMapStatistics.html#a17">setMapSize</a>(uint32 mapID, uint32 mapSize);
00290    
00297    <span class="keywordtype">int</span> <a class="code" href="classMapStatistics.html#a18">getLoadedMaps</a>(set&lt;uint32&gt;&amp; maps);
00298    
00303    <span class="keywordtype">int</span> <a class="code" href="classMapStatistics.html#a19">getAllMapInfo</a>(set&lt;MapElement&gt;&amp; maps);
00304 
<a name="l00309"></a><a class="code" href="classMapStatistics.html#a20">00309</a>    <span class="keywordtype">float</span> <a class="code" href="classMapStatistics.html#a20">getLoad1</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_loadAvg_1; }
00310 
<a name="l00315"></a><a class="code" href="classMapStatistics.html#a21">00315</a>    <span class="keywordtype">float</span> <a class="code" href="classMapStatistics.html#a21">getLoad5</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_loadAvg_5; }
00316 
<a name="l00321"></a><a class="code" href="classMapStatistics.html#a22">00321</a>    <span class="keywordtype">float</span> <a class="code" href="classMapStatistics.html#a22">getLoad15</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_loadAvg_15; }
00322 
00323    
00328    <span class="keywordtype">bool</span> <a class="code" href="classMapStatistics.html#a23">removeMap</a>(uint32 mapID);
00329       
00334    <span class="keyword">virtual</span> <a class="code" href="Types_8h.html#a21">uint32</a> <a class="code" href="classMapStatistics.html#a24">getProcessTime</a>() <span class="keyword">const</span>;
00335 
00339    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classMapStatistics.html#a25">getUserName</a>() <span class="keyword">const</span>;
00340    
<a name="l00344"></a><a class="code" href="classMapStatistics.html#a26">00344</a>    <span class="keywordtype">int</span> <a class="code" href="classMapStatistics.html#a26">jobThreadWorking</a>()<span class="keyword"> const </span>{
00345       <span class="keywordflow">return</span> m_jobThreadWorking;
00346    }
00347    
00354    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="classMapStatistics.html#a27">setStatus</a>(uint32 mapID, MapElement::status_t status);
00355 
00359    <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="classMapStatistics.html#a28">updateLastUse</a>( uint32 mapID );
00360 
00364    <span class="keyword">friend</span> ostream&amp; <a class="code" href="classMapStatistics.html#n0">operator&lt;&lt;</a>(ostream&amp; stream, <span class="keyword">const</span> <a class="code" href="classMapStatistics.html">MapStatistics</a>&amp; stats);
00365    
00372    ostream&amp; <a class="code" href="classMapStatistics.html#a29">printAllWithStatus</a>(ostream&amp; stream,
00373                                MapElement::status_t allowedStatus,
00374                                <span class="keyword">const</span> <span class="keywordtype">char</span>* prefix,
00375                                <span class="keyword">const</span> <span class="keywordtype">char</span>* postfix) <span class="keyword">const</span>;
00376 
00381    ostream&amp; <a class="code" href="classMapStatistics.html#a30">printWithStatus</a>(ostream&amp; stream,
00382                             <span class="keyword">const</span> <a class="code" href="classMapElement.html">MapElement</a>&amp; me,
00383                             <span class="keyword">const</span> <span class="keywordtype">char</span>* prefix,
00384                             MapElement::status_t allowedStatus,
00385                             <span class="keywordtype">bool</span>&amp; first) <span class="keyword">const</span>;
00386 
00393    pair&lt;uint32, uint32&gt; <a class="code" href="classMapStatistics.html#a31">getOldestMapAndAge</a>( set&lt;uint32&gt;&amp; avoid,
00394                                             <span class="keywordtype">bool</span> pretendNew = <span class="keyword">false</span> ) <span class="keyword">const</span>;
00395 
00399    <a class="code" href="classMapStatistics.html">MapStatistics</a>&amp; <a class="code" href="classMapStatistics.html#a32">operator += </a>( <span class="keyword">const</span> <a class="code" href="classMapStatistics.html">MapStatistics</a> &amp;o );
00400       
00401 <span class="keyword">protected</span>:
00402 
00406    <span class="keywordtype">int</span> <a class="code" href="classMapStatistics.html#a2">save</a>(<a class="code" href="classPacket.html">Packet</a>* p, <span class="keywordtype">int</span>&amp; pos,
00407             uint64 optMem, uint64 maxMem,
00408             <span class="keywordtype">int</span> queueLength,
00409             int32 rank) <span class="keyword">const</span>;
00410 
00417    <span class="keywordtype">bool</span> <a class="code" href="classMapStatistics.html#b1">addMap</a>(uint32 mapID, uint32 size);
00418     
00424    <a class="code" href="classMapElement.html">MapElement</a>* <a class="code" href="classMapStatistics.html#b2">linearSearch</a>(uint32 mapID);
00425    
00426 <span class="keyword">protected</span>:
00427    
<a name="l00429"></a><a class="code" href="classMapStatistics.html#p0">00429</a>    <a class="code" href="Types_8h.html#a21">uint32</a> m_processTime;
00430    
<a name="l00432"></a><a class="code" href="classMapStatistics.html#p1">00432</a>    <a class="code" href="Types_8h.html#a23">uint64</a> m_optMem;
00433    
<a name="l00435"></a><a class="code" href="classMapStatistics.html#p2">00435</a>    <a class="code" href="Types_8h.html#a23">uint64</a> m_maxMem;
00436    
<a name="l00438"></a><a class="code" href="classMapStatistics.html#p3">00438</a>    <span class="keywordtype">int</span> m_queueLength;
00439 
<a name="l00441"></a><a class="code" href="classMapStatistics.html#p4">00441</a>    <span class="keywordtype">int</span> m_jobThreadWorking;
00442 
<a name="l00444"></a><a class="code" href="classMapStatistics.html#p5">00444</a>    <a class="code" href="classMC2String.html">MC2String</a> m_userName;
00445 
<a name="l00447"></a><a class="code" href="classMapStatistics.html#p6">00447</a>    <a class="code" href="Types_8h.html#a26">float32</a> m_loadAvg_1;
<a name="l00449"></a><a class="code" href="classMapStatistics.html#p7">00449</a>    <a class="code" href="Types_8h.html#a26">float32</a> m_loadAvg_5;
<a name="l00451"></a><a class="code" href="classMapStatistics.html#p8">00451</a>    <a class="code" href="Types_8h.html#a26">float32</a> m_loadAvg_15;
00452 
<a name="l00454"></a><a class="code" href="classMapStatistics.html#p9">00454</a>    <a class="code" href="Types_8h.html#a21">uint32</a> m_lastLoadTime;
00455 
00456 };
00457 
00458 
00459 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jun 30 10:11:47 2010 for mc2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
