<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mc2: NameUtility.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">Shared</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">include</a></div>
<h1>NameUtility.h</h1><a href="NameUtility_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment">Copyright (c) 1999 - 2010, Vodafone Group Services Ltd</span>
00003 <span class="comment">All rights reserved.</span>
00004 <span class="comment"></span>
00005 <span class="comment">Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</span>
00006 <span class="comment"></span>
00007 <span class="comment">    * Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</span>
00008 <span class="comment">    * Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</span>
00009 <span class="comment">    * Neither the name of the Vodafone Group Services Ltd nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</span>
00010 <span class="comment"></span>
00011 <span class="comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00012 <span class="comment">*/</span>
00013 
00014 <span class="preprocessor">#ifndef NAME_UTILITY_H</span>
00015 <span class="preprocessor"></span><span class="preprocessor">#define NAME_UTILITY_H</span>
00016 <span class="preprocessor"></span>
00017 <span class="preprocessor">#include "<a class="code" href="config_8h.html">config.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="ItemTypes_8h.html">ItemTypes.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="LangTypes_8h.html">LangTypes.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="StringTable_8h.html">StringTable.h</a>"</span>
00021 
00022 <span class="preprocessor">#include &lt;vector&gt;</span>
00023 <span class="preprocessor">#include &lt;set&gt;</span>
00024 <span class="preprocessor">#include &lt;map&gt;</span>
00025 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00026 
<a name="l00031"></a><a class="code" href="classNameUtility.html">00031</a> <span class="keyword">class </span><a class="code" href="classNameUtility.html">NameUtility</a> {
00032 <span class="keyword">public</span>:
00046   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> getBestName(<span class="keywordtype">int</span> nbrNames,
00047                                 <span class="keyword">const</span> <a class="code" href="Types_8h.html#a21">uint32</a>* stringIdx,
00048                                 LangTypes::language_t reqlang,
00049                                 set&lt;uint32&gt;* usedStrings = NULL,
00050                                 <span class="keywordtype">bool</span> acceptUniqueName = <span class="keyword">true</span>);
00051 
00052   
00067   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> getBestName(<span class="keywordtype">int</span> nbrNames,
00068                                 <span class="keyword">const</span> <a class="code" href="Types_8h.html#a21">uint32</a>* stringIdx,
00069                                 <span class="keyword">const</span> <a class="code" href="classvector.html">vector&lt;LangTypes::language_t&gt;</a>&amp; reqLangs,
00070                                 set&lt;uint32&gt;* usedStrings = NULL,
00071                                 <span class="keywordtype">bool</span> acceptUniqueName = <span class="keyword">true</span>);
00072 
00081   <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="Types_8h.html#a21">uint32</a> getLangPoints(LangTypes::language_t itemLang,
00082                                      LangTypes::language_t reqLang);
00083                                                                               
00084 
00092   <span class="keyword">static</span> StringTable::languageCode getBestLanguage( 
00093      LangTypes::language_t lang, <a class="code" href="Types_8h.html#a21">uint32</a>&amp; dist );
00094 
00095 
00109   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> getBestNameOfType(<span class="keywordtype">int</span> nbrNames,
00110                                       <span class="keyword">const</span> <a class="code" href="Types_8h.html#a21">uint32</a>* stringIdx,
00111                                       LangTypes::language_t reqlang,
00112                                       ItemTypes::name_t reqType,
00113                                       set&lt;uint32&gt;* usedStrings = NULL);  
00114 
00127   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span>
00128      getBestNameOfType(<span class="keywordtype">int</span> nbrNames,
00129                        <span class="keyword">const</span> <a class="code" href="Types_8h.html#a21">uint32</a>* stringIdx,
00130                        <span class="keyword">const</span> <a class="code" href="classvector.html">vector&lt;LangTypes::language_t&gt;</a>&amp; reqlangs,
00131                        ItemTypes::name_t reqType,
00132                        set&lt;uint32&gt;* usedStrings = NULL);
00133 
00145   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> getExactName(<span class="keywordtype">int</span> nbrNames,
00146                                  <span class="keyword">const</span> <a class="code" href="Types_8h.html#a21">uint32</a>* stringIdx,
00147                                  LangTypes::language_t reqLang,
00148                                  ItemTypes::name_t reqType,
00149                                  set&lt;uint32&gt;* usedStrings = NULL);
00150 
00165   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> getName(<span class="keywordtype">int</span> nbrNames,
00166                             <span class="keyword">const</span> <a class="code" href="Types_8h.html#a21">uint32</a>* stringIdx,
00167                             LangTypes::language_t reqLang,
00168                             ItemTypes::name_t reqType,
00169                             set&lt;uint32&gt;* usedStrings = NULL);     
00170   
<a name="l00175"></a><a class="code" href="classNameUtility.html#s0">00175</a>   <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="Types_8h.html#a21">uint32</a> maxLangPoints;
00176 
00177 
00178   <span class="keyword">typedef</span> <a class="code" href="classmap.html">map</a>&lt; LangTypes::language_t, 
<a name="l00179"></a><a class="code" href="classNameUtility.html#w0">00179</a>      pair&lt; StringTable::languageCode, uint32 &gt; &gt; <a class="code" href="classmap.html">bestLanguageCodeMap</a>;
00180 
00181    <span class="keyword">typedef</span> <a class="code" href="classmap.html">map&lt; LangTypes::language_t, map&lt; LangTypes::language_t, int &gt;</a> &gt; 
<a name="l00182"></a><a class="code" href="classNameUtility.html#w1">00182</a>       <a class="code" href="classmap.html">PreferedLanguageCont</a>;
00183 
00184 
00194   <span class="keyword">static</span> <span class="keyword">inline</span> LangTypes::language_t getNumberNameValue(<span class="keyword">const</span> <span class="keywordtype">char</span>* name);
00195  
00196   <span class="keyword">private</span>:
00201   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> innerGetBestName(<span class="keywordtype">int</span> nbrNames,
00202                                      <span class="keyword">const</span> uint32* stringIdx,
00203                                      LangTypes::language_t reqlang,
00204                                      set&lt;uint32&gt;* usedStrings,
00205                                      <span class="keywordtype">bool</span> acceptUniqueName = <span class="keyword">true</span>);
00206 
00211   <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> innerGetBestNameOfType(<span class="keywordtype">int</span> nbrNames,
00212                                            <span class="keyword">const</span> uint32* stringIdx,
00213                                            LangTypes::language_t reqlang,
00214                                            ItemTypes::name_t reqType,
00215                                            set&lt;uint32&gt;* usedStrings);
00216 
00217 
<a name="l00222"></a><a class="code" href="classNameUtility.html#v0">00222</a>   <span class="keyword">static</span> bestLanguageCodeMap m_bestLanguageCodeMap;
00223 
<a name="l00228"></a><a class="code" href="classNameUtility.html#v1">00228</a>    <span class="keyword">static</span> PreferedLanguageCont m_preferedLanguage;
00229 };
00230 
00231 
00232 <span class="keyword">inline</span> <a class="code" href="Types_8h.html#a21">uint32</a>
<a name="l00233"></a><a class="code" href="classNameUtility.html#e2">00233</a> <a class="code" href="classNameUtility.html#e2">NameUtility::getLangPoints</a>(LangTypes::language_t reqLang,
00234                            LangTypes::language_t itemLang)
00235 {
00236    <span class="keywordflow">if</span> ( reqLang == itemLang ) {
00237       <span class="comment">// Best</span>
00238       <span class="keywordflow">return</span> NameUtility::maxLangPoints;
00239    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( itemLang == LangTypes::invalidLanguage ) {
00240       <span class="comment">// Worst</span>
00241       <span class="keywordflow">return</span> 0;
00242    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( itemLang == LangTypes::english ) {
00243       <span class="comment">// English is the best language if not the requested was found.</span>
00244       <span class="keywordflow">return</span> <a class="code" href="classNameUtility.html#s0">NameUtility::maxLangPoints</a> - 1;
00245    } <span class="keywordflow">else</span> {
00246       <span class="comment">// FIXME: This works in Finland where English</span>
00247       <span class="comment">//        chooses Finnish names over Swedish ones</span>
00248       <span class="comment">//        and Norwegian chooses Swedish.</span>
00249       <span class="comment">//        Use a method like the one in StringSearchUtility</span>
00250       <span class="comment">//        instead.</span>
00251       <span class="keywordflow">return</span> abs((<span class="keywordtype">int</span>)(reqLang) - (<span class="keywordtype">int</span>)(itemLang)) + 1;
00252    }
00253 }
00254 
00255 <span class="comment">// Check if the stringInfo can be used.</span>
<a name="l00256"></a><a class="code" href="NameUtility_8h.html#a0">00256</a> <span class="preprocessor">#define CAN_USE(x) ( ( usedStrings == NULL ) ||\</span>
00257 <span class="preprocessor">                     ( usedStrings-&gt;find(x) == usedStrings-&gt;end() ) )</span>
00258 <span class="preprocessor"></span>
00259 <span class="comment">// Insert the string into the usedStrings</span>
<a name="l00260"></a><a class="code" href="NameUtility_8h.html#a1">00260</a> <span class="preprocessor">#define I_HAVE_USED(x)  do { if ( usedStrings != NULL) {\</span>
00261 <span class="preprocessor">                         usedStrings-&gt;insert(x); }} while (0)</span>
00262 <span class="preprocessor"></span>
00263 <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00264"></a><a class="code" href="classNameUtility.html#h1">00264</a> <a class="code" href="classNameUtility.html#h1">NameUtility::innerGetBestNameOfType</a>(<span class="keywordtype">int</span> nbrNames,
00265                                     <span class="keyword">const</span> uint32* stringIdx,
00266                                     LangTypes::language_t reqlang,
00267                                     ItemTypes::name_t reqType,
00268                                     set&lt;uint32&gt;* usedStrings)
00269 {
00270    <span class="keywordtype">int</span> bestPoints = -1;
00271    <span class="keywordtype">int</span> bestIndex = -1;
00272    <span class="keywordtype">int</span> i;
00273    PreferedLanguageCont::const_iterator prefLangs = <a class="code" href="classNameUtility.html#v1">m_preferedLanguage</a>.find(
00274       reqlang );
00275    <span class="keywordflow">for</span>( i = 0; i &lt; nbrNames; i++) {
00276       <a class="code" href="Types_8h.html#a21">uint32</a> stringInfo = stringIdx[i];
00277       <span class="keywordflow">if</span> ( ! <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a>( stringInfo ) ) {
00278          <span class="keywordflow">continue</span>;
00279       }
00280       ItemTypes::name_t stringType = <a class="code" href="ItemTypes_8h.html#a7">GET_STRING_TYPE</a>(stringInfo);
00281       LangTypes::language_t language = <a class="code" href="ItemTypes_8h.html#a4">GET_STRING_LANGUAGE</a>(stringInfo);
00282       <span class="keywordflow">if</span>( stringType == reqType ) {
00283          <span class="keywordflow">if</span>(reqType == ItemTypes::roadNumber){
00284             <span class="comment">// Handle different as language means name priority.</span>
00285             <span class="comment">// If this is not set all roadNumber still have same value.</span>
00286             <span class="keywordtype">int</span> points = (int)language;
00287             <span class="keywordflow">if</span> ( points &gt; bestPoints ) {
00288                bestPoints = points;
00289                bestIndex  = i;
00290             }
00291          }
00292          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( language == reqlang ) {
00293             <span class="comment">// Correct language - we can return now</span>
00294             <span class="keywordflow">return</span> i;
00295          } <span class="keywordflow">else</span> {
00296             <span class="comment">// Get the language points.</span>
00297             <span class="keywordtype">int</span> points = <a class="code" href="classNameUtility.html#e2">getLangPoints</a>(reqlang, language);
00298             <span class="keywordflow">if</span> ( prefLangs != <a class="code" href="classNameUtility.html#v1">m_preferedLanguage</a>.end() ) {
00299                PreferedLanguageCont::mapped_type::const_iterator findIt =
00300                   (*prefLangs).second.find( language );
00301                <span class="keywordflow">if</span> ( findIt != (*prefLangs).second.end() ) {
00302                   <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: found pref lang "</span>
00303                          &lt;&lt; <a class="code" href="classLangTypes.html#e0">LangTypes::getLanguageAsString</a>( language, <span class="keyword">true</span> )
00304                          &lt;&lt; <span class="stringliteral">" points "</span> &lt;&lt; <a class="code" href="MC2Logging_8h.html#a12">MC2HEX</a>( findIt-&gt;second ) &lt;&lt; endl;
00305                   points = findIt-&gt;second;
00306                }
00307             }
00308             <span class="keywordflow">if</span> ( points &gt; bestPoints ) {
00309                bestPoints = points;
00310                bestIndex  = i;
00311             }
00312          }
00313       }
00314    }
00315    <span class="keywordflow">return</span> bestIndex;
00316 }
00317 
00318 <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00319"></a><a class="code" href="classNameUtility.html#e4">00319</a> <a class="code" href="classNameUtility.html#e4">NameUtility::getBestNameOfType</a>(<span class="keywordtype">int</span> nbrNames,
00320                                <span class="keyword">const</span> uint32* stringIdx,
00321                                LangTypes::language_t reqlang,
00322                                ItemTypes::name_t reqType,
00323                                set&lt;uint32&gt;* usedStrings)
00324 {
00325    <span class="keywordtype">int</span> idx = <a class="code" href="classNameUtility.html#h1">innerGetBestNameOfType</a>(nbrNames, stringIdx, reqlang,
00326                                     reqType, usedStrings );
00327    <span class="keywordflow">if</span> ( idx &gt;= 0 ) {
00328       <a class="code" href="NameUtility_8h.html#a1">I_HAVE_USED</a>( stringIdx[idx] );
00329    }
00330    
00331    <span class="keywordflow">return</span> idx;
00332 }
00333 
00334 <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00335"></a><a class="code" href="classNameUtility.html#e5">00335</a> <a class="code" href="classNameUtility.html#e4">NameUtility::getBestNameOfType</a>(<span class="keywordtype">int</span> nbrNames,
00336                                <span class="keyword">const</span> uint32* stringIdx,
00337                                <span class="keyword">const</span> <a class="code" href="classvector.html">vector&lt;LangTypes::language_t&gt;</a>&amp; reqlangs,
00338                                ItemTypes::name_t reqType,
00339                                set&lt;uint32&gt;* usedStrings)
00340 {
00341    <span class="keywordtype">int</span> bestIdx = -1;
00342    <span class="comment">// Initialized later if bestIdx &lt; 0.</span>
00343    <a class="code" href="Types_8h.html#a21">uint32</a> bestPoints = 0;
00344    <span class="keywordflow">for</span> ( <a class="code" href="Types_8h.html#a21">uint32</a> i = 0; i &lt; reqlangs.size(); ++i ) {
00345       <span class="keywordtype">int</span> idx = <a class="code" href="classNameUtility.html#h1">innerGetBestNameOfType</a>(nbrNames, stringIdx, reqlangs[i],
00346                                        reqType, usedStrings);
00347       <span class="comment">// Check if ok.</span>
00348       <span class="keywordflow">if</span> ( idx &lt; 0 ) {
00349          <span class="comment">// No names of that type.</span>
00350          <span class="keywordflow">return</span> idx;
00351       }
00352       
00353       <a class="code" href="Types_8h.html#a21">uint32</a> nbrPoints = <a class="code" href="classNameUtility.html#e2">getLangPoints</a>(<a class="code" href="ItemTypes_8h.html#a4">GET_STRING_LANGUAGE</a>(stringIdx[idx]),
00354                                        reqlangs[i]);
00355       <span class="keywordflow">if</span> ( (bestIdx &lt; 0) ||
00356            (nbrPoints &gt; bestPoints) ) {
00357          bestIdx = i;
00358          bestPoints = nbrPoints;
00359       }      
00360    }
00361    <span class="keywordflow">if</span> ( bestIdx &gt;= 0 ) {
00362       <a class="code" href="NameUtility_8h.html#a1">I_HAVE_USED</a>( stringIdx[bestIdx] );
00363    }
00364    <span class="keywordflow">return</span> bestIdx;
00365 }
00366 
00367 <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00368"></a><a class="code" href="classNameUtility.html#h0">00368</a> <a class="code" href="classNameUtility.html#h0">NameUtility::innerGetBestName</a>(<span class="keywordtype">int</span> nbrNames,
00369                               <span class="keyword">const</span> uint32* stringIdx,
00370                               LangTypes::language_t reqlang,
00371                               set&lt;uint32&gt;* usedStrings,
00372                               <span class="keywordtype">bool</span> acceptUniqueName)
00373 {
00374    <span class="keywordtype">int</span> i = 0;
00375    <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Requested language is "</span>
00376            &lt;&lt; <a class="code" href="classLangTypes.html#e0">LangTypes::getLanguageAsString</a>(reqlang, <span class="keyword">true</span>)
00377            &lt;&lt; endl;
00378 
00379    <span class="keywordflow">if</span> ( nbrNames == 1 ) {
00380       <span class="keywordflow">if</span> ( <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a>( stringIdx[0] ) ) {
00381          <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Taking only name "</span> &lt;&lt; endl;
00382          <span class="keywordflow">return</span> i;
00383       } <span class="keywordflow">else</span> {
00384          <span class="keywordflow">return</span> -1;
00385       }
00386    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( nbrNames == 0 ) {
00387       <span class="keywordflow">return</span> -1;
00388    }
00389    
00390    <span class="comment">// Unique names are probably the best.</span>
00391    <span class="keywordflow">if</span> (acceptUniqueName) {
00392       <span class="keywordflow">for</span>( i = 0; i &lt; nbrNames; i++) {
00393          <a class="code" href="Types_8h.html#a21">uint32</a> stringInfo = stringIdx[i];
00394          <span class="keywordflow">if</span> ( ! <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a> ( stringInfo ) ) {
00395             <span class="keywordflow">continue</span>;
00396          }
00397          <a class="code" href="Types_8h.html#a21">uint32</a> stringType = <a class="code" href="ItemTypes_8h.html#a7">GET_STRING_TYPE</a>(stringInfo);
00398          <span class="keywordflow">if</span>( stringType == ItemTypes::uniqueName ) {
00399             <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Found unique name"</span> &lt;&lt; endl;
00400             <span class="keywordflow">return</span> i;
00401          }
00402       }
00403    }
00404 
00405    <span class="keywordflow">for</span>( i = 0; i &lt; nbrNames; i++) {
00406       <a class="code" href="Types_8h.html#a21">uint32</a> stringInfo = stringIdx[i];
00407       <span class="keywordflow">if</span> ( ! <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a> ( stringInfo ) ) {
00408          <span class="keywordflow">continue</span>;
00409       }
00410       LangTypes::language_t language = <a class="code" href="ItemTypes_8h.html#a4">GET_STRING_LANGUAGE</a>(stringInfo);
00411       <a class="code" href="Types_8h.html#a21">uint32</a> nameType = <a class="code" href="ItemTypes_8h.html#a7">GET_STRING_TYPE</a>(stringInfo);
00412       <span class="keywordflow">if</span>( (nameType == ItemTypes::officialName) &amp;&amp;
00413           (language == reqlang) ) {
00414          <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Found official name correct lang"</span> &lt;&lt; endl;
00415          <span class="keywordflow">return</span> i;
00416       }
00417    }     
00418 
00419    <span class="keywordflow">for</span>( i = 0; i &lt; nbrNames; i++) {
00420       <a class="code" href="Types_8h.html#a21">uint32</a> stringInfo = stringIdx[i];
00421       <span class="keywordflow">if</span> ( ! <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a> ( stringInfo ) ) {
00422          <span class="keywordflow">continue</span>;
00423       }
00424       LangTypes::language_t language = <a class="code" href="ItemTypes_8h.html#a4">GET_STRING_LANGUAGE</a>(stringInfo);
00425       <a class="code" href="Types_8h.html#a21">uint32</a> nameType = <a class="code" href="ItemTypes_8h.html#a7">GET_STRING_TYPE</a>(stringInfo);
00426       <span class="keywordflow">if</span>( (nameType == ItemTypes::alternativeName) &amp;&amp;
00427           (language == reqlang) ) {
00428          <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Found alternative name correct lang"</span> &lt;&lt; endl;
00429          <span class="keywordflow">return</span> i;
00430       }
00431    }     
00432 
00433    <span class="keywordtype">int</span> tmpIdx = <a class="code" href="classNameUtility.html#e4">getBestNameOfType</a>(nbrNames, stringIdx, reqlang,
00434                                   ItemTypes::officialName, usedStrings );
00435    <span class="keywordflow">if</span> ( tmpIdx &gt;= 0 ) {
00436       <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Found nice official name in "</span>
00437              &lt;&lt; <a class="code" href="classLangTypes.html#e0">LangTypes::getLanguageAsString</a>(
00438                 <a class="code" href="ItemTypes_8h.html#a4">GET_STRING_LANGUAGE</a>(stringIdx[tmpIdx]), <span class="keyword">true</span>)
00439              &lt;&lt; endl;
00440       <span class="keywordflow">return</span> tmpIdx;
00441    }
00442 
00443    <span class="comment">// We will not get here.</span>
00444    <span class="keywordflow">for</span>( i = 0; i &lt; nbrNames; i++) {
00445       <a class="code" href="Types_8h.html#a21">uint32</a> stringInfo = stringIdx[i];
00446       <span class="keywordflow">if</span> ( ! <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a> ( stringInfo ) ) {
00447          <span class="keywordflow">continue</span>;
00448       }
00449       <a class="code" href="Types_8h.html#a21">uint32</a> language = <a class="code" href="ItemTypes_8h.html#a4">GET_STRING_LANGUAGE</a>(stringInfo);
00450       <a class="code" href="Types_8h.html#a21">uint32</a> nameType = <a class="code" href="ItemTypes_8h.html#a7">GET_STRING_TYPE</a>(stringInfo);
00451       <span class="keywordflow">if</span>( (nameType == ItemTypes::officialName) &amp;&amp;
00452           (language == LangTypes::english) ) {
00453          <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Found official name in english"</span> &lt;&lt; endl;
00454          <span class="keywordflow">return</span> i;
00455       }
00456    }
00457 
00458    <span class="keywordflow">for</span>( i = 0; i &lt; nbrNames; i++) {
00459       <a class="code" href="Types_8h.html#a21">uint32</a> stringInfo = stringIdx[i];
00460       <span class="keywordflow">if</span> ( ! <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a> ( stringInfo ) ) {
00461          <span class="keywordflow">continue</span>;
00462       }
00463       <a class="code" href="Types_8h.html#a21">uint32</a> nameType = <a class="code" href="ItemTypes_8h.html#a7">GET_STRING_TYPE</a>(stringInfo);
00464       <span class="keywordflow">if</span>( nameType == ItemTypes::officialName ) {
00465          <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Found official name"</span> &lt;&lt; endl;
00466          <span class="keywordflow">return</span> i;
00467       }
00468    }
00469 
00470    <span class="keywordflow">for</span>( i = 0; i &lt; nbrNames; i++) {
00471       <a class="code" href="Types_8h.html#a21">uint32</a> stringInfo = stringIdx[i];
00472       <span class="keywordflow">if</span> ( ! <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a> ( stringInfo ) ) {
00473          <span class="keywordflow">continue</span>;
00474       }
00475       <a class="code" href="Types_8h.html#a21">uint32</a> language = <a class="code" href="ItemTypes_8h.html#a4">GET_STRING_LANGUAGE</a>(stringInfo);
00476       <a class="code" href="Types_8h.html#a21">uint32</a> nameType = <a class="code" href="ItemTypes_8h.html#a7">GET_STRING_TYPE</a>(stringInfo);
00477       <span class="keywordflow">if</span>( (nameType == ItemTypes::alternativeName) &amp;&amp;
00478           (language == LangTypes::english) ) {
00479          <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Found alternative name in english"</span> &lt;&lt; endl;
00480          <span class="keywordflow">return</span> i;
00481       }
00482    }
00483 
00484    <span class="keywordflow">for</span>( i = 0; i &lt; nbrNames; i++) {
00485       <a class="code" href="Types_8h.html#a21">uint32</a> stringInfo = stringIdx[i];
00486       <span class="keywordflow">if</span> ( ! <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a> ( stringInfo ) ) {
00487          <span class="keywordflow">continue</span>;
00488       }
00489       <a class="code" href="Types_8h.html#a21">uint32</a> nameType = <a class="code" href="ItemTypes_8h.html#a7">GET_STRING_TYPE</a>(stringInfo);
00490       <span class="keywordflow">if</span>( nameType == ItemTypes::alternativeName ) {
00491          <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Found alternative name"</span> &lt;&lt; endl;
00492          <span class="keywordflow">return</span> i;
00493       }
00494    }
00495    
00496    <span class="keywordtype">int</span> bestPoints = -1;
00497    <span class="keywordtype">int</span> bestIndex  = -1;
00498    <span class="keywordflow">for</span>( i = 0; i &lt; nbrNames; i++) {
00499       <a class="code" href="Types_8h.html#a21">uint32</a> stringInfo = stringIdx[i];
00500       <span class="keywordflow">if</span> ( ! <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a> ( stringInfo ) ) {
00501          <span class="keywordflow">continue</span>;
00502       }
00503       <a class="code" href="Types_8h.html#a21">uint32</a> nameType = <a class="code" href="ItemTypes_8h.html#a7">GET_STRING_TYPE</a>(stringInfo);
00504       <span class="keywordflow">if</span>( nameType == ItemTypes::roadNumber ) {
00505          <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Found roadnumber"</span> &lt;&lt; endl;
00506          <span class="keywordtype">int</span> points = (int)(<a class="code" href="ItemTypes_8h.html#a4">GET_STRING_LANGUAGE</a>(stringInfo));
00507          <span class="keywordflow">if</span>(points &gt; bestPoints){
00508             bestPoints = points;
00509             bestIndex  = i;
00510          }
00511       }
00512       <span class="keywordflow">if</span>(bestIndex != -1) <span class="comment">// There might be no roadnumber names.</span>
00513          <span class="keywordflow">return</span> bestIndex;
00514    }
00515    
00516    <span class="comment">// return the first allowed name</span>
00517    <span class="keywordflow">for</span> ( i = 0; i &lt; nbrNames; ++i ) {
00518       <span class="keywordflow">if</span> ( <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a>( stringIdx[i] ) ) {
00519          <a class="code" href="MC2Logging_8h.html#a6">mc2dbg8</a> &lt;&lt; <span class="stringliteral">"[NameU]: Taking first allowed name"</span> &lt;&lt; endl;
00520          <span class="keywordflow">return</span> i;
00521       }
00522    }
00523    <span class="comment">// No allowed name found.</span>
00524    <span class="keywordflow">return</span> -1;
00525 }
00526 
00527 <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00528"></a><a class="code" href="classNameUtility.html#e0">00528</a> <a class="code" href="classNameUtility.html#e0">NameUtility::getBestName</a>(<span class="keywordtype">int</span> nbrNames,
00529                          <span class="keyword">const</span> uint32* stringIdx,
00530                          LangTypes::language_t reqlang,
00531                          set&lt;uint32&gt;* usedStrings,
00532                          <span class="keywordtype">bool</span> acceptUniqueName)
00533 {
00534    <span class="keywordtype">int</span> idx = <a class="code" href="classNameUtility.html#h0">innerGetBestName</a>(nbrNames, stringIdx,
00535                               reqlang, usedStrings,
00536                               acceptUniqueName);
00537    <span class="keywordflow">if</span> ( idx &gt;= 0 ) {
00538       <a class="code" href="NameUtility_8h.html#a1">I_HAVE_USED</a>( stringIdx[idx] );
00539    }
00540    <span class="keywordflow">return</span> idx;
00541 }
00542 
00543 <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00544"></a><a class="code" href="classNameUtility.html#e1">00544</a> <a class="code" href="classNameUtility.html#e0">NameUtility::getBestName</a>(<span class="keywordtype">int</span> nbrNames,
00545                          <span class="keyword">const</span> uint32* stringIdx,
00546                          <span class="keyword">const</span> <a class="code" href="classvector.html">vector&lt;LangTypes::language_t&gt;</a>&amp; reqLangs,
00547                          set&lt;uint32&gt;* usedStrings,
00548                          <span class="keywordtype">bool</span> acceptUniqueName)
00549 {
00550    <span class="comment">// Check if there are zero names</span>
00551    <span class="keywordflow">if</span> ( nbrNames == 0 ) {
00552       <span class="keywordflow">return</span> nbrNames - 1;
00553    }
00554    
00555    <span class="keywordtype">int</span> bestIdx = -1;
00556    <span class="comment">// Initialized later if bestIdx &lt; 0.</span>
00557    <a class="code" href="Types_8h.html#a21">uint32</a> bestPoints = 0;
00558    <span class="keywordflow">for</span>( <a class="code" href="Types_8h.html#a21">uint32</a> i = 0; i &lt; reqLangs.size(); ++i ) {
00559       <span class="keywordtype">int</span> idx = <a class="code" href="classNameUtility.html#h0">innerGetBestName</a>(nbrNames, stringIdx,
00560                                  reqLangs[i], usedStrings,
00561                                  acceptUniqueName);
00562       <span class="keywordflow">if</span> ( idx &lt; 0 ) {
00563          <span class="keywordflow">continue</span>;
00564       }                        
00565       <a class="code" href="Types_8h.html#a21">uint32</a> nbrPoints = <a class="code" href="classNameUtility.html#e2">getLangPoints</a>(<a class="code" href="ItemTypes_8h.html#a4">GET_STRING_LANGUAGE</a>(stringIdx[idx]),
00566                                        reqLangs[i]);
00567       <span class="keywordflow">if</span> ( (bestIdx &lt; 0) ||
00568            (nbrPoints &gt; bestPoints) ) {
00569          bestIdx = i;
00570          bestPoints = nbrPoints;
00571       }
00572    }
00573    <span class="keywordflow">if</span> ( bestIdx &gt;= 0 ) {
00574       <a class="code" href="NameUtility_8h.html#a1">I_HAVE_USED</a>( stringIdx[bestIdx] );
00575    }
00576    <span class="keywordflow">return</span> bestIdx;
00577 }
00578 
00579 <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00580"></a><a class="code" href="classNameUtility.html#e6">00580</a> <a class="code" href="classNameUtility.html#e6">NameUtility::getExactName</a>(<span class="keywordtype">int</span> nbrNames,
00581                           <span class="keyword">const</span> uint32* stringIdx,
00582                           LangTypes::language_t reqLang,
00583                           ItemTypes::name_t reqType,
00584                           set&lt;uint32&gt;* usedStrings)
00585 {
00586    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; nbrNames; ++i ) {
00587       <span class="keywordflow">if</span> ( ! <a class="code" href="NameUtility_8h.html#a0">CAN_USE</a> ( stringIdx[i] ) ) {
00588          <span class="keywordflow">continue</span>;
00589       }
00590       LangTypes::language_t language = <a class="code" href="ItemTypes_8h.html#a4">GET_STRING_LANGUAGE</a>(stringIdx[i]);
00591       ItemTypes::name_t nameType     = <a class="code" href="ItemTypes_8h.html#a7">GET_STRING_TYPE</a>(stringIdx[i]);
00592       <span class="keywordflow">if</span> ( language == reqLang ) {
00593          <span class="keywordflow">if</span> ( nameType == reqType ) {
00594             <a class="code" href="NameUtility_8h.html#a1">I_HAVE_USED</a> ( stringIdx[i] );
00595             <span class="keywordflow">return</span> i;
00596          }
00597       }
00598    }
00599    <span class="comment">// Not found.</span>
00600    <span class="keywordflow">return</span> -1;
00601 }
00602 
00603 <span class="keyword">inline</span> <span class="keywordtype">int</span>
<a name="l00604"></a><a class="code" href="classNameUtility.html#e7">00604</a> <a class="code" href="classNameUtility.html#e7">NameUtility::getName</a>(<span class="keywordtype">int</span> nbrNames,
00605                      <span class="keyword">const</span> uint32* stringIdx,
00606                      LangTypes::language_t reqLang,
00607                      ItemTypes::name_t reqType,
00608                      set&lt;uint32&gt;* usedStrings)
00609 {
00610    <span class="comment">// N.B! Adds the index to usedStrings if used.</span>
00611    <span class="keywordtype">int</span> idx = <a class="code" href="classNameUtility.html#e6">getExactName</a>(nbrNames, stringIdx, reqLang, reqType, usedStrings);
00612    <span class="comment">// Return if ok</span>
00613    <span class="keywordflow">if</span> ( idx &gt;= 0 ) {
00614       <span class="keywordflow">return</span> idx;
00615    }
00616    <span class="comment">// N.B! Adds the index to usedStrings if used.</span>
00617    idx = <a class="code" href="classNameUtility.html#e4">getBestNameOfType</a>(nbrNames, stringIdx, reqLang, reqType, usedStrings);
00618    <span class="comment">// Return if ok</span>
00619    <span class="keywordflow">if</span> ( idx &gt;= 0 ) {
00620       <span class="keywordflow">return</span> idx;
00621    } <span class="keywordflow">else</span> {
00622       <span class="comment">// N.B! Adds the index to usedStrings if used.</span>
00623       <span class="keywordflow">return</span> <a class="code" href="classNameUtility.html#e0">getBestName</a>(nbrNames, stringIdx, reqLang, usedStrings);
00624    }   
00625 }
00626 
00627 <span class="keyword">inline</span> LangTypes::language_t
<a name="l00628"></a><a class="code" href="classNameUtility.html#e8">00628</a> <a class="code" href="classNameUtility.html#e8">NameUtility::getNumberNameValue</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* name){
00629       <span class="comment">// if number name change language to indicate name priority.</span>
00630       <span class="comment">// 0 - Number roads without a character.</span>
00631       <span class="comment">// 1.- Number roads without a new character.</span>
00632       <span class="comment">// 2.- K roads</span>
00633       <span class="comment">// 3.- L roads</span>
00634       <span class="comment">// 4.- U roads</span>
00635       <span class="comment">// 5.- E roads</span>
00636       <span class="comment">// 6.- B &amp; N roads</span>
00637       <span class="comment">// 7.- A roads</span>
00638       <span class="comment">// 8.- M roads</span>
00639    <span class="keywordflow">if</span>(name == NULL)
00640       <span class="keywordflow">return</span> LangTypes::invalidLanguage;
00641    <span class="keywordflow">switch</span> (name[0]){
00642       <span class="keywordflow">case</span> <span class="charliteral">'M'</span> :
00643          <span class="keywordflow">return</span> <a class="code" href="classLangTypes.html#w99">LangTypes::language_t</a>(8);
00644          <span class="keywordflow">break</span>;
00645       <span class="keywordflow">case</span> <span class="charliteral">'A'</span> :
00646          <span class="keywordflow">return</span> <a class="code" href="classLangTypes.html#w99">LangTypes::language_t</a>(7);
00647             <span class="keywordflow">break</span>;
00648       <span class="keywordflow">case</span> <span class="charliteral">'B'</span> :
00649          <span class="keywordflow">return</span> <a class="code" href="classLangTypes.html#w99">LangTypes::language_t</a>(6);
00650          <span class="keywordflow">break</span>;
00651       <span class="keywordflow">case</span> <span class="charliteral">'N'</span> :
00652          <span class="keywordflow">return</span> <a class="code" href="classLangTypes.html#w99">LangTypes::language_t</a>(6);
00653          <span class="keywordflow">break</span>;
00654       <span class="keywordflow">case</span> <span class="charliteral">'E'</span> :
00655          <span class="keywordflow">return</span> <a class="code" href="classLangTypes.html#w99">LangTypes::language_t</a>(5);
00656          <span class="keywordflow">break</span>;
00657       <span class="keywordflow">case</span> <span class="charliteral">'U'</span> :
00658          <span class="keywordflow">return</span> <a class="code" href="classLangTypes.html#w99">LangTypes::language_t</a>(4);
00659          <span class="keywordflow">break</span>;
00660       <span class="keywordflow">case</span> <span class="charliteral">'L'</span> :
00661          <span class="keywordflow">return</span> <a class="code" href="classLangTypes.html#w99">LangTypes::language_t</a>(3);
00662          <span class="keywordflow">break</span>;
00663       <span class="keywordflow">case</span> <span class="charliteral">'K'</span> :
00664          <span class="keywordflow">return</span> <a class="code" href="classLangTypes.html#w99">LangTypes::language_t</a>(2);
00665          <span class="keywordflow">break</span>;
00666       <span class="keywordflow">default</span> :
00667          <span class="keywordflow">return</span> <a class="code" href="classLangTypes.html#w99">LangTypes::language_t</a>(0);
00668          <span class="keywordflow">break</span>;
00669    }
00670 }
00671 
00672 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jun 30 10:11:48 2010 for mc2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.3.9.1 </small></address>
</body>
</html>
